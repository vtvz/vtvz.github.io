<!doctype html>
<html lang="en">
    <!--Built at : 2019-10-07 23:13:10-->
    <head>
        
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <title>Jekyll Spoiler Plugin. Куда и как прятать код</title>

        <link rel="stylesheet" href="/assets/css/bootstrap.css">
        <link rel="stylesheet" href="/assets/css/main.css">
        <link rel="stylesheet" href="/assets/css/type/budicons.css">
        <link rel="stylesheet" href="/assets/css/type/fontello.css">
        <link href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">
        <link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700,800&subset=latin,cyrillic" rel="stylesheet" crossorigin="anonymous">

        <link rel="alternate" type="application/rss+xml" title="Виталий Заславский – web-разработчик, который любит свое дело" href="https://vtvz.ru/feed.xml">

        <meta name="theme-color" content="#232323">

        <!-- Begin Jekyll SEO tag v2.6.0 -->
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="Jekyll Spoiler Plugin. Куда и как прятать код" />
<meta name="author" content="Виталий Заславский" />
<meta property="og:locale" content="ru_RU" />
<meta name="description" content="Куда и как спрятать код в постах, если у тебя Jekyll. В статье представлен код Jekyll Spoiler Plugin для всеобщего использования" />
<meta property="og:description" content="Куда и как спрятать код в постах, если у тебя Jekyll. В статье представлен код Jekyll Spoiler Plugin для всеобщего использования" />
<link rel="canonical" href="https://vtvz.ru/blog/jekyll-spoiler-plugin/" />
<meta property="og:url" content="https://vtvz.ru/blog/jekyll-spoiler-plugin/" />
<meta property="og:site_name" content="Виталий Заславский – web-разработчик, который любит свое дело" />
<meta property="og:image" content="https://vtvz.ru/assets/images/logo-black.png" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2019-03-08T00:00:00+03:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:image" content="https://vtvz.ru/assets/images/logo-black.png" />
<meta property="twitter:title" content="Jekyll Spoiler Plugin. Куда и как прятать код" />
<meta name="twitter:site" content="@vtvz_ru" />
<meta name="twitter:creator" content="@vtvz_ru" />
<meta name="google-site-verification" content="08mKX1M9WC3jlftJg-ZY3MsQEQTRV0w5fQaynQLwMXI" />
<meta name="yandex-verification" content="66bb5c18895519c2" />
<script type="application/ld+json">
{"@type":"BlogPosting","url":"https://vtvz.ru/blog/jekyll-spoiler-plugin/","headline":"Jekyll Spoiler Plugin. Куда и как прятать код","dateModified":"2019-03-08T00:00:00+03:00","datePublished":"2019-03-08T00:00:00+03:00","image":"https://vtvz.ru/assets/images/logo-black.png","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://vtvz.ru/assets/images/logo-black.png"},"name":"Виталий Заславский"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://vtvz.ru/blog/jekyll-spoiler-plugin/"},"author":{"@type":"Person","name":"Виталий Заславский"},"description":"Куда и как спрятать код в постах, если у тебя Jekyll. В статье представлен код Jekyll Spoiler Plugin для всеобщего использования","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

    </head>

    <body class="full-layout">
        <div id="preloader"><div id="status"><div class="spinner"></div></div></div>

<div id="bg"></div>

<div class="body-wrapper">
      <nav class="navbar navbar-default" role="navigation">
    <div class="navbar-header">
      <a class="btn responsive-menu" data-toggle="collapse" data-target=".navbar-collapse"><i></i></a>
      <div class="navbar-brand text-center">
        <a href="/">
          <img src="/assets/images/logo.svg" alt="Logo" class="logo">
        </a>
      </div>
      <!-- /.navbar-brand -->
    </div>
    <!-- /.navbar-header -->
    <div class="collapse navbar-collapse">
      <ul class="nav navbar-nav">
        <!-- <li class="current"> -->
        <li>
            <a href="/" class="hint--right" data-hint="Главная"><i class="budicon-home-1"></i><span>Главная</span></a>
        </li>
        <li class="current">
            <a href="/blog/" class="hint--right" data-hint="Блог"><i class="budicon-book-1"></i><span>Блог</span></a>
        </li>
      </ul>
      <!-- /.navbar-nav -->
    </div>
    <!-- /.navbar-collapse -->
  </nav>
  <!-- /.navbar -->

    <div class="container inner">
    <div class="blog list-view row">
        <div class="col-md-8 col-sm-12 content">
            <div class="blog-posts">
    <div class="post box">
        <div class="meta">
    <span class="category"><a href="/blog/category/%D1%80%D0%B0%D0%B7%D1%80%D0%B0%D0%B1%D0%BE%D1%82%D0%BA%D0%B0/">Разработка</a></span>
    <span class="date">08 мар 2019</span>
    
    <span class="reading-time" title="Примерное время чтения">
        

        <!--719-->

        
            ~3 мин.
        
    </span>
</div>

        <h1 class="post-title">
            <a href="/blog/jekyll-spoiler-plugin/">Jekyll Spoiler Plugin. Куда и как прятать код</a>
        </h1>
        <div>
            <p>Когда писал <a href="/blog/html-to-mysql/">предыдущую статью</a>, столкнулся с одной простой проблемой: большие куски кода занимали больше места, чем сам текст.</p>

<p>Поиск готового решения для спойлеров привел меня на вот <a href="https://burrowl.com/blog/2015/05/23/spoiler-block/" target="_blank" rel="noopener noreferrer">эту страничку</a>.
Решение простое и гениальное, но имело один большой недостаток: текст внутри спойлера не форматировался.</p>

<p>Свое решение я опишу в этой статье.</p>

<a id="cut"></a>
<details class="spoiler"><summary class="spoiler-title">TL;DR. Для тех, кому лень читать целиком.</summary><div class="spoiler-body">
<p>Это нужно положить в папку <code class="highlighter-rouge">_plugins</code>:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">module</span> <span class="nn">Jekyll</span>
  <span class="k">class</span> <span class="nc">SpoilerBlock</span> <span class="o">&lt;</span> <span class="no">Liquid</span><span class="o">::</span><span class="no">Block</span>
    <span class="k">def</span> <span class="nf">initialize</span> <span class="p">(</span><span class="n">tag_name</span><span class="p">,</span> <span class="n">markup</span><span class="p">,</span> <span class="n">tokens</span><span class="p">)</span>
      <span class="k">super</span>
      <span class="vi">@summary</span> <span class="o">=</span> <span class="n">markup</span><span class="p">.</span><span class="nf">strip</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">render</span><span class="p">(</span><span class="n">context</span><span class="p">)</span>
      <span class="n">site</span> <span class="o">=</span> <span class="n">context</span><span class="p">.</span><span class="nf">registers</span><span class="p">[</span><span class="ss">:site</span><span class="p">]</span>
      <span class="n">converter</span> <span class="o">=</span> <span class="n">site</span><span class="p">.</span><span class="nf">find_converter_instance</span><span class="p">(</span><span class="no">Jekyll</span><span class="o">::</span><span class="no">Converters</span><span class="o">::</span><span class="no">Markdown</span><span class="p">)</span>

      <span class="n">output</span> <span class="o">=</span> <span class="s1">'&lt;details class="spoiler"&gt;'</span>
      <span class="n">output</span> <span class="o">&lt;&lt;</span> <span class="s2">"&lt;summary class=</span><span class="se">\"</span><span class="s2">spoiler-title</span><span class="se">\"</span><span class="s2">&gt;</span><span class="si">#{</span><span class="vi">@summary</span><span class="p">.</span><span class="nf">empty?</span> <span class="p">?</span> <span class="s1">'Открыть'</span> <span class="p">:</span> <span class="vi">@summary</span><span class="si">}</span><span class="s2">&lt;/summary&gt;"</span>
      <span class="n">output</span> <span class="o">&lt;&lt;</span> <span class="s1">'&lt;div class="spoiler-body"&gt;'</span>
      <span class="n">output</span> <span class="o">&lt;&lt;</span> <span class="n">converter</span><span class="p">.</span><span class="nf">convert</span><span class="p">(</span><span class="k">super</span><span class="p">)</span>
      <span class="n">output</span> <span class="o">&lt;&lt;</span> <span class="s1">'&lt;/div&gt;'</span>
      <span class="n">output</span> <span class="o">&lt;&lt;</span> <span class="s1">'&lt;/details&gt;'</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="no">Liquid</span><span class="o">::</span><span class="no">Template</span><span class="p">.</span><span class="nf">register_tag</span><span class="p">(</span><span class="s1">'spoiler'</span><span class="p">,</span> <span class="no">Jekyll</span><span class="o">::</span><span class="no">SpoilerBlock</span><span class="p">)</span>
</code></pre></div></div>

</div></details>

<h2 id="проблема">Проблема</h2>

<p>Если любой код поместить внутрь HTML тега, то он будет отрисован как есть. То есть вот этот кусок кода:</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;details</span> <span class="na">class=</span><span class="s">"spoiler"</span><span class="nt">&gt;</span>
<span class="nt">&lt;summary</span> <span class="na">class=</span><span class="s">"spoiler-title"</span><span class="nt">&gt;</span>Заголовок спойлера<span class="nt">&lt;/summary&gt;</span>
<span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"spoiler-body"</span><span class="nt">&gt;</span>
**Тут должен быть жирный текст**

```
А это *должен* быть кусок кода
```
<span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/details&gt;</span>
</code></pre></div></div>

<p>Выдаст вот такой результат:</p>

<details class="spoiler">
    <summary class="spoiler-title">Заголовок спойлера</summary>
    <div class="spoiler-body">
    **Тут должен быть жирный текст**
    
    ```
    А это *должен* быть кусок кода
    ```
    </div>
</details>

<p>Мы можем заставить Jekyll парсить код внутри HTML элементов:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># _config.yml</span>
<span class="na">kramdown</span><span class="pi">:</span>
  <span class="na">parse_block_html</span><span class="pi">:</span> <span class="no">true</span>
</code></pre></div></div>

<p>Но результат сильно лучше не станет:</p>

<figure class="frame">
  <img src="broken-html.png" alt="Поехавшая разметка">
</figure>

<h2 id="решение">Решение</h2>

<p>Решение напрашивается само собой: нужно содержание спойлера индивидуально прогонять через конвертёр.</p>

<p>Когда-то я читал спецификацию по Ruby, но для меня он до сей поры остается языком инопланетян.
(Говорят, что Ruby очень популярен в Японии. Кажется, это все объясняет).
Я даже кажется <a href="https://github.com/jekyll/jekyll/blob/master/lib/jekyll/filters.rb#L16" target="_blank" rel="noopener noreferrer">нашел</a> используемый в Liquid фильтр для конвертации. Но так и не смог его победить.</p>

<p>В итоге после короткого гугления нашел вот этот рецепт:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">site</span> <span class="o">=</span> <span class="n">context</span><span class="p">.</span><span class="nf">registers</span><span class="p">[</span><span class="ss">:site</span><span class="p">]</span>
<span class="n">converter</span> <span class="o">=</span> <span class="n">site</span><span class="p">.</span><span class="nf">find_converter_instance</span><span class="p">(</span><span class="no">Jekyll</span><span class="o">::</span><span class="no">Converters</span><span class="o">::</span><span class="no">Markdown</span><span class="p">)</span>
<span class="n">converter</span><span class="p">.</span><span class="nf">convert</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
</code></pre></div></div>

<p>Остается все это дело собрать воедино вот так:</p>

<details class="spoiler"><summary class="spoiler-title">Все то же, что и в TL;DR выше</summary><div class="spoiler-body">
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">module</span> <span class="nn">Jekyll</span>
  <span class="k">class</span> <span class="nc">SpoilerBlock</span> <span class="o">&lt;</span> <span class="no">Liquid</span><span class="o">::</span><span class="no">Block</span>
    <span class="k">def</span> <span class="nf">initialize</span> <span class="p">(</span><span class="n">tag_name</span><span class="p">,</span> <span class="n">markup</span><span class="p">,</span> <span class="n">tokens</span><span class="p">)</span>
      <span class="k">super</span>
      <span class="vi">@summary</span> <span class="o">=</span> <span class="n">markup</span><span class="p">.</span><span class="nf">strip</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">render</span><span class="p">(</span><span class="n">context</span><span class="p">)</span>
      <span class="n">site</span> <span class="o">=</span> <span class="n">context</span><span class="p">.</span><span class="nf">registers</span><span class="p">[</span><span class="ss">:site</span><span class="p">]</span>
      <span class="n">converter</span> <span class="o">=</span> <span class="n">site</span><span class="p">.</span><span class="nf">find_converter_instance</span><span class="p">(</span><span class="no">Jekyll</span><span class="o">::</span><span class="no">Converters</span><span class="o">::</span><span class="no">Markdown</span><span class="p">)</span>

      <span class="n">output</span> <span class="o">=</span> <span class="s1">'&lt;details class="spoiler"&gt;'</span>
      <span class="n">output</span> <span class="o">&lt;&lt;</span> <span class="s2">"&lt;summary class=</span><span class="se">\"</span><span class="s2">spoiler-title</span><span class="se">\"</span><span class="s2">&gt;</span><span class="si">#{</span><span class="vi">@summary</span><span class="p">.</span><span class="nf">empty?</span> <span class="p">?</span> <span class="s1">'Открыть'</span> <span class="p">:</span> <span class="vi">@summary</span><span class="si">}</span><span class="s2">&lt;/summary&gt;"</span>
      <span class="n">output</span> <span class="o">&lt;&lt;</span> <span class="s1">'&lt;div class="spoiler-body"&gt;'</span>
      <span class="n">output</span> <span class="o">&lt;&lt;</span> <span class="n">converter</span><span class="p">.</span><span class="nf">convert</span><span class="p">(</span><span class="k">super</span><span class="p">)</span>
      <span class="n">output</span> <span class="o">&lt;&lt;</span> <span class="s1">'&lt;/div&gt;'</span>
      <span class="n">output</span> <span class="o">&lt;&lt;</span> <span class="s1">'&lt;/details&gt;'</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="no">Liquid</span><span class="o">::</span><span class="no">Template</span><span class="p">.</span><span class="nf">register_tag</span><span class="p">(</span><span class="s1">'spoiler'</span><span class="p">,</span> <span class="no">Jekyll</span><span class="o">::</span><span class="no">SpoilerBlock</span><span class="p">)</span>
</code></pre></div></div>

</div></details>

<p>Положить в папку <code class="highlighter-rouge">_plugins</code>. И далее можно использовать в любом Markdown документе вот так:</p>

<div class="language-markdown highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{% spoiler Заголовок спойлера %}
<span class="p">```</span><span class="nl">yaml</span>
<span class="na">content</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s2">"</span><span class="s">some</span><span class="nv"> </span><span class="s">string"</span>
<span class="p">```</span>
{% endspoiler %}
</code></pre></div></div>

<p>Вот с таким вот результатом:</p>

<details class="spoiler"><summary class="spoiler-title">Заголовок спойлера</summary><div class="spoiler-body">
<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">content</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s2">"</span><span class="s">some</span><span class="nv"> </span><span class="s">string"</span>
</code></pre></div></div>
</div></details>

<p>Используйте на здоровье <img class="emoji" title=":grin:" alt=":grin:" src="/assets/images/emoji/unicode/1f601.png" height="20" width="20"></p>


        </div>
        <div class="meta tags">
            
            <a href="/blog/tag/%D0%B2%D0%B5%D0%B1-%D1%80%D0%B0%D0%B7%D1%80%D0%B0%D0%B1%D0%BE%D1%82%D0%BA%D0%B0/">Веб-разработка</a>,
            
            <a href="/blog/tag/jekyll/">Jekyll</a>
            
        </div>
    </div>
    <div class="box">
        <div class="row">
            
            <div class="col-xs-12 col-sm-6 text-left">
                <div>« Предыдущая</div>
                <a class="prev" href="/blog/html-to-mysql/">HTML to MySQL. Или Веб-скрапинг на практике</a>
            </div>
            

            
            <div class="col-xs-12 col-sm-6 text-right">
                <div>Следующая »</div>
                <a class="next" href="/blog/why-audio-streaming-platforms/">Платить или не платить. Или зачем нужны стриминговые платформы</a>
            </div>
            
        </div>
    </div>
    
</div>

        </div>

        <aside class="col-md-4 col-sm-12 sidebar">
                    
                    <div class="sidebox box widget hidden-sm hidden-xs">
                        <h3 class="widget-title section-title">В этой статье:</h3>
                        <ul class="circled">
  <li><a href="#%D0%BF%D1%80%D0%BE%D0%B1%D0%BB%D0%B5%D0%BC%D0%B0">Проблема</a></li>
  <li><a href="#%D1%80%D0%B5%D1%88%D0%B5%D0%BD%D0%B8%D0%B5">Решение</a></li>
</ul>

                    </div>
                    

                    <div class="sidebox box widget">
                        <h3 class="widget-title section-title">Категории</h3>
                        <ul class="circled">
                            
                            <li><a href="/blog/category/%D1%80%D0%B0%D0%B7%D1%80%D0%B0%D0%B1%D0%BE%D1%82%D0%BA%D0%B0/">Разработка
                                [3]</a></li>
                            
                            <li><a href="/blog/category/%D1%81%D0%B5%D1%80%D0%B2%D0%B8%D1%81%D1%8B/">Сервисы
                                [1]</a></li>
                            
                        </ul>
                    </div>

                    <div class="sidebox box widget">
                        <h3 class="widget-title section-title">Теги</h3>
                        <ul class="tag-list">
                            
                            <li><a href="/blog/tag/%D0%B1%D0%BB%D0%BE%D0%B3/" class="btn">Блог
                                [1]</a></li>
                            
                            <li><a href="/blog/tag/%D0%B2%D0%B5%D0%B1-%D1%80%D0%B0%D0%B7%D1%80%D0%B0%D0%B1%D0%BE%D1%82%D0%BA%D0%B0/" class="btn">Веб-разработка
                                [3]</a></li>
                            
                            <li><a href="/blog/tag/%D0%B1%D0%B0%D0%B7%D1%8B-%D0%B4%D0%B0%D0%BD%D0%BD%D1%8B%D1%85/" class="btn">Базы данных
                                [1]</a></li>
                            
                            <li><a href="/blog/tag/jekyll/" class="btn">Jekyll
                                [1]</a></li>
                            
                            <li><a href="/blog/tag/%D0%BC%D1%83%D0%B7%D1%8B%D0%BA%D0%B0/" class="btn">Музыка
                                [1]</a></li>
                            
                            <li><a href="/blog/tag/%D1%81%D0%B5%D1%80%D0%B2%D0%B8%D1%81%D1%8B/" class="btn">Сервисы
                                [1]</a></li>
                            
                        </ul>
                    </div>

                    
        </aside>
    </div>
</div>

</div>

<script src="/assets/js/jquery.min.js"></script> 
<script src="/assets/js/bootstrap.min.js"></script> 
<script src="/assets/js/jquery.themepunch.tools.min.js"></script> 
<script src="/assets/js/classie.js"></script> 
<script src="/assets/js/plugins.js"></script> 
<script src="/assets/js/scripts.js"></script>  

        <script type="text/javascript" src="/assets/javascripts/bundle.js" charset="utf-8"></script>

        
        <!-- Yandex.Metrika counter -->
        <script type="text/javascript"> (function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)}; m[i].l=1*new Date();k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)}) (window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym"); ym(31771726, "init", { id:31771726, clickmap:true, trackLinks:true, accurateTrackBounce:true, webvisor:true }); </script> <noscript><div><img src="https://mc.yandex.ru/watch/31771726" style="position:absolute; left:-9999px;" alt=""></div></noscript>
        <!-- /Yandex.Metrika counter -->

        <!-- Global site tag (gtag.js) - Google Analytics -->
        <script async src="https://www.googletagmanager.com/gtag/js?id=UA-131047185-1"></script>
        <script>
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());

          gtag('config', 'UA-131047185-1');
        </script>

        
    </body>
</html>
