<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" xml:lang="ru_RU"><generator uri="https://jekyllrb.com/" version="3.8.5">Jekyll</generator><link href="https://vtvz.ru/feed.xml" rel="self" type="application/atom+xml" /><link href="https://vtvz.ru/" rel="alternate" type="text/html" hreflang="ru_RU" /><updated>2020-01-09T13:46:13+03:00</updated><id>https://vtvz.ru/feed.xml</id><title type="html">Виталий Заславский – web-разработчик, который любит свое дело</title><subtitle>Личный блог web-разработчика обо всем. Заметки об успехах и неудачах в профессиональной деятельности, о поиске решений практических задач, и просто о жизни.
</subtitle><author><name>Виталий Заславский</name><email>vtvz@pm.me</email></author><entry><title type="html">Калькулятор расходов для ИП по УСН Доходы</title><link href="https://vtvz.ru/blog/entrepreneur-calculator/" rel="alternate" type="text/html" title="Калькулятор расходов для ИП по УСН Доходы" /><published>2020-01-08T00:00:00+03:00</published><updated>2020-01-08T00:00:00+03:00</updated><id>https://vtvz.ru/blog/entrepreneur-calculator</id><content type="html" xml:base="https://vtvz.ru/blog/entrepreneur-calculator/">&lt;p&gt;Многие знают, что я индивидуальный предприниматель. И все знают, что я программист.
А это значит, что любая работа поддающаяся автоматизации должна быть автоматизирована.
Поэтому я решил создать этот калькулятор. Как для своего удобства, так и во благо других.&lt;/p&gt;

&lt;!--cut--&gt;

&lt;p&gt;Если ты ИП по УСН по доходам, то этот инструмент будет очень кстати.
Его цель – высчитать чистый доход с учетом всех основных текущих и будущих затрат.
В эти затраты входят: банковская комиссия, страховые выплаты (ПФР и ФФОМС) и непосредственно сам налог.&lt;/p&gt;

&lt;h2 id=&quot;как-это-работает&quot;&gt;Как это работает&lt;/h2&gt;

&lt;ol&gt;
  &lt;li&gt;Вбиваете ваш доход за месяц или год в строку “Доход”;&lt;/li&gt;
  &lt;li&gt;В строке “Чистая прибыль” указана сумма, которую можно безопасно вывести;&lt;/li&gt;
  &lt;li&gt;Остаток нужно отложить на отдельный счет или оставить на расчетном счете вашего ИП 
– эти деньги пригодятся для оплаты страховых взносов и налогов;&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;Подобный расчет работает только в том случае, если вы выплачиваете ПФР и ФФОМС &lt;strong&gt;ежеквартально&lt;/strong&gt;.
Таким образом можно очень сильно уменьшить или даже исключить налог по УСН.
До тех пор, пока ежемесячный доход в 2020 году составит не более 45,000 рублей,
не придется платить &lt;strong&gt;ни рубля налогов&lt;/strong&gt; – только страховые взносы!&lt;/p&gt;

&lt;h2 id=&quot;для-чего-это-нужно&quot;&gt;Для чего это нужно&lt;/h2&gt;

&lt;ol&gt;
  &lt;li&gt;Этим можно пользоваться как инструментом бухгалтерии для расчета всех необходимых выплат;&lt;/li&gt;
  &lt;li&gt;Можно оценить чистый доход от сделки или выполненных работ;&lt;/li&gt;
  &lt;li&gt;Или наоборот – подогнать стоимость сделки, чтобы выхлоп был не меньше желаемого;&lt;/li&gt;
&lt;/ol&gt;

&lt;h2 id=&quot;как-пользоваться&quot;&gt;Как пользоваться&lt;/h2&gt;

&lt;p&gt;На текущий момент функциональность калькулятора не обширная, и я сомневаюсь,
что буду делать с ним что-то еще помимо обновления цифр по годам. Но вот что есть уже сейчас:&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;Выберите год. Вероятно, год меньше 2020-го будет уже не актуальным,
но если нужно посчитать страховые взносы за предыдущий год, можно выбрать и 2019.&lt;/li&gt;
  &lt;li&gt;Пункт “Оплата расчетного счета в месяц” позволяет выбрать тарифный план вашего банка.
Я, например, плачу 1% от всего моего дохода, поэтому я выбираю пункт “Процент от дохода”.
Если вы платите фиксированную сумму, выберите соответствующий пункт.&lt;/li&gt;
  &lt;li&gt;Поле “Количество” определяет число, применимое к вашему тарифному плану:
    &lt;ul&gt;
      &lt;li&gt;В случае “Процент от дохода” – комиссия в процентах от дохода;&lt;/li&gt;
      &lt;li&gt;А в “Фиксированная абонентская плата” – ежемесячная комиссия в рублях за использование расчетного счета.&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ol&gt;

&lt;h2 id=&quot;калькулятор&quot;&gt;Калькулятор&lt;/h2&gt;

&lt;div id=&quot;calculator-container&quot;&gt;&lt;/div&gt;

&lt;script&gt;
window.callOnReady.push(
    function() {
        main.calculator(document.getElementById('calculator-container'));
    }
);
&lt;/script&gt;

&lt;h2 id=&quot;послесловие&quot;&gt;Послесловие&lt;/h2&gt;

&lt;p&gt;Я очень надеюсь, что нигде не накосячил. Сначала это все рассчитывалось в обычной Excel таблице.
Расчеты там и тут сходятся. Да и в мобильной бухгалтерии все гладко.
Но если я что-то сделал не так – пожалуйста, поправьте меня.
Внизу есть блок с комментариями – пишите ваши замечания и пожелания.&lt;/p&gt;

&lt;p&gt;Спасибо за внимание :blush:&lt;/p&gt;</content><author><name>Виталий Заславский</name><email>vtvz@pm.me</email></author><category term="ИП" /><category term="Бизнес" /><category term="Налоги" /><category term="УСН" /><summary type="html">Многие знают, что я индивидуальный предприниматель. И все знают, что я программист. А это значит, что любая работа поддающаяся автоматизации должна быть автоматизирована. Поэтому я решил создать этот калькулятор. Как для своего удобства, так и во благо других.</summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="https://vtvz.ru/blog/entrepreneur-calculator/cover.jpg" /><media:content medium="image" url="https://vtvz.ru/blog/entrepreneur-calculator/cover.jpg" xmlns:media="http://search.yahoo.com/mrss/" /></entry><entry><title type="html">Очистка Android от предустановленных программ без Root’а и перепрошивки</title><link href="https://vtvz.ru/blog/android-debloating/" rel="alternate" type="text/html" title="Очистка Android от предустановленных программ без Root'а и перепрошивки" /><published>2020-01-06T00:00:00+03:00</published><updated>2020-01-06T00:00:00+03:00</updated><id>https://vtvz.ru/blog/android-debloating</id><content type="html" xml:base="https://vtvz.ru/blog/android-debloating/">&lt;p&gt;До недавнего времени я свято верил, что предустановленные программы в Android устройствах
могут быть либо выключены, либо удалены только с перепрошивкой телефона.
Root доступ дает не только большие возможности, но и большие риски.
Поэтому я не стал перепрошивать свой телефон и оставил родную прошивку.
Но не так давно я &lt;a href=&quot;https://habr.com/ru/post/482344/&quot;&gt;обнаружил&lt;/a&gt;, что есть вполне рабочий способ удалить намертво установленные программы со своего устройства.&lt;/p&gt;

&lt;!--cut--&gt;

&lt;h2 id=&quot;зачем&quot;&gt;Зачем?&lt;/h2&gt;

&lt;p&gt;При покупке устройства, вместе с телефоном/планшетом идет просто гора различных программ – бесполезных и даже вредных.
В первую очередь, это все то, что начинается с “Google” (Music, Photo, Video, Maps, Hangouts…).
А с китайскими телефонами типа Xiaomi тянется еще ворох различного мусора.
Думаю, проблема еще больше усугубится, когда будет в полной мере заработает &lt;a href=&quot;https://www.kommersant.ru/doc/4179598&quot;&gt;закон&lt;/a&gt; об предустановке российского ПО на новые девайсы.&lt;/p&gt;

&lt;p&gt;Это барахло не только занимает место на телефоне, но и съедает ресурсы, сажает батарею и вечно обновляется через Play Market.
Последней каплей было то, когда Google Maps спросил меня “Ну и как вам было в Burger King?”.
Большинство программ, особенно встроенных, отслеживают всё, что вы делаете.
Даже если вам нечего скрывать, это все равно как-то не этично и немного жутковато.&lt;/p&gt;

&lt;p&gt;Перепрошивать телефон сложно и не безопасно. Всегда есть шанс превратить устройство в кирпич.
Но есть один замечательный способ удалить весь этот мусор без подобных рисков.&lt;/p&gt;

&lt;div class=&quot;alert alert-danger&quot; role=&quot;alert&quot;&gt;
    &lt;p&gt;&lt;b&gt;Будьте очень аккуратны!&lt;/b&gt;&lt;/p&gt;
    &lt;p&gt;
        Хоть этот способ очистки устройства намного проще всех остальных мне знакомых,
        он все равно требует определенных технических знаний и навыков.
        Будьте очень аккуратны, чтобы не повредить устройство и не удалить ПО, необходимое для работы системы. 
    &lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;Весь этот процесс называется “Debloating”, что переводится как “&lt;strong&gt;раз&lt;/strong&gt;раздувать”,
то есть обратное значение слову “раздувать”.&lt;/p&gt;

&lt;h2 id=&quot;инструкция&quot;&gt;Инструкция&lt;/h2&gt;

&lt;ol&gt;
  &lt;li&gt;&lt;a href=&quot;https://4idroid.com/kak-vklyuchit-rezhim-dlya-razrabotchika-v-android/&quot;&gt;Включите&lt;/a&gt; “режим разработчика”;&lt;/li&gt;
  &lt;li&gt;Включите “Отладка по USB” в разделе “Для разработчиков”;&lt;/li&gt;
  &lt;li&gt;Установите &lt;a href=&quot;https://play.google.com/store/apps/details?id=bg.projectoria.appinspector&quot;&gt;App Inspector&lt;/a&gt;; &lt;br /&gt;
 &lt;em&gt;Это не обязательный пункт&lt;/em&gt;. В некоторых системах (как у меня в MIUI 9.6.2) ID приложения можно узнать так:
    &lt;ul&gt;
      &lt;li&gt;Настройки&lt;/li&gt;
      &lt;li&gt;Все приложения&lt;/li&gt;
      &lt;li&gt;Нужное приложение&lt;/li&gt;
      &lt;li&gt;Значок ⓘ в верхнем правом углу&lt;/li&gt;
      &lt;li&gt;Имя пакета&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;Установите &lt;a href=&quot;https://www.xda-developers.com/install-adb-windows-macos-linux/&quot;&gt;Adb&lt;/a&gt; на компьютер;&lt;/li&gt;
  &lt;li&gt;В App Inspector найдите приложение, которое хотите удалить.
 Из всех данных необходимо только поле “Package name”;&lt;/li&gt;
  &lt;li&gt;Подключите устройство по USB к компьютеру;&lt;/li&gt;
  &lt;li&gt;Введите команду &lt;code class=&quot;highlighter-rouge&quot;&gt;adb devices&lt;/code&gt;. Должен быть примерно следующий вывод:
    &lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt; &lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;adb devices
 List of devices attached
 6c3eaa477cf3    device
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
    &lt;p&gt;То есть, после строчки &lt;code class=&quot;highlighter-rouge&quot;&gt;List of devices attached&lt;/code&gt; должна быть еще одна с ID подключенного устройства.
 Идти дальше нет смысла, если компьютер не видит ваш девайс.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;Введите &lt;code class=&quot;highlighter-rouge&quot;&gt;adb uninstall &amp;lt;package-name&amp;gt;&lt;/code&gt;, где &lt;code class=&quot;highlighter-rouge&quot;&gt;&amp;lt;package-name&amp;gt;&lt;/code&gt; – поле из пункта 5.
 В моем случае – &lt;code class=&quot;highlighter-rouge&quot;&gt;com.google.android.tts&lt;/code&gt;. Результат:
    &lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt; &lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;adb uninstall com.google.android.tts
 Success
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
  &lt;/li&gt;
  &lt;li&gt;После удаления всех ненужных приложений выключите “режим разработчика” или хотя бы “отладку по USB”.
 Это важно, потому что в режиме отладки устройство очень уязвимо.&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;В случае, если у вас Xiaomi, возможно, лучше воспользоваться инструментом “&lt;a href=&quot;https://www.reddit.com/r/Xiaomi/wiki/debloat&quot;&gt;Xiaomi ADB/Fastboot Tools&lt;/a&gt;”.
Во-первых, он имеет графический интерфейс. А во-вторых, что самое главное,
в списке программ доступных для удаления нет того, что является критичным для работоспособности системы.
Но, хоть и говорят, что из этого списка можно удалять все, я бы не рекомендовал вслепую сносить все подряд.&lt;/p&gt;

&lt;h2 id=&quot;итого&quot;&gt;Итого&lt;/h2&gt;

&lt;p&gt;Пока сложно сказать об объективных результатах очистки телефона,
но места на устройстве стало значительно больше, анимация стала плавнее,
а занятой оперативной памяти – меньше.&lt;/p&gt;

&lt;p&gt;Если что-то не получается или есть какие-то вопросы – ниже есть секция с комментариями.
Буду рад любому фитбеку :blush:&lt;/p&gt;</content><author><name>Виталий Заславский</name><email>vtvz@pm.me</email></author><category term="Android" /><category term="Оптимизация" /><summary type="html">До недавнего времени я свято верил, что предустановленные программы в Android устройствах могут быть либо выключены, либо удалены только с перепрошивкой телефона. Root доступ дает не только большие возможности, но и большие риски. Поэтому я не стал перепрошивать свой телефон и оставил родную прошивку. Но не так давно я обнаружил, что есть вполне рабочий способ удалить намертво установленные программы со своего устройства.</summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="https://vtvz.ru/blog/android-debloating/cover.jpg" /><media:content medium="image" url="https://vtvz.ru/blog/android-debloating/cover.jpg" xmlns:media="http://search.yahoo.com/mrss/" /></entry><entry><title type="html">Первый успех. Больше ста визитов за неделю</title><link href="https://vtvz.ru/blog/first-success/" rel="alternate" type="text/html" title="Первый успех. Больше ста визитов за неделю" /><published>2019-11-30T00:00:00+03:00</published><updated>2019-11-30T00:00:00+03:00</updated><id>https://vtvz.ru/blog/first-success</id><content type="html" xml:base="https://vtvz.ru/blog/first-success/">&lt;p&gt;Мой блог, как мой питомец. Я его люблю, вкладываю туда свои время и силы.
Для создания чего-то нового приходится тратить свой творческий ресурс.
Да, даже чисто техническая статья должна быть интересной, неоднотонной, без повторяющихся слов, грамотной, корректной
и другие страшные слова.&lt;/p&gt;

&lt;p&gt;Потратив этот ресурс, так или иначе хочется, чтобы это творение не осталось незамеченным.
Художники делают выставки, музыканты записывают треки, танцоры выступают на концертах и т.д.
А авторы статей и блогеры хотят, чтобы их читали. Хоть мой блог и был создал в первую очередь для меня,
мне все равно не хочется писать впустую, а каждое посещение странички греет мне сердце.
Тут коротко о моих первых успехах в продвижении сайта.&lt;/p&gt;

&lt;!--cut--&gt;

&lt;figure class=&quot;frame&quot;&gt;
    &lt;a href=&quot;./intro-report.png&quot; target=&quot;_blank&quot;&gt;
      &lt;img src=&quot;./intro-report.png&quot; alt=&quot;Отчет по источникам за год&quot; /&gt;
    &lt;/a&gt;
&lt;/figure&gt;

&lt;p&gt;Есть много способов продвинуть свой сайт в люди без сильных расходов. Да, это будет гораздо медленнее и не так эффективно,
чем грамотно сделанная реклама. Но и за бесплатно можно достичь некоторых результатов.&lt;/p&gt;

&lt;h2 id=&quot;никнейм&quot;&gt;Никнейм&lt;/h2&gt;

&lt;p&gt;Однажды, незадолго после окончания школы (~2013г.), мне представилась замечательная возможность приобрести свой личный домен.
Соглашусь, делается это несложно. Но тогда я не умел ничего связанного с реальной разработкой веб-сайтов.
Я хотел что-то короткое, лаконичное, созвучное с моим ФИО. Все трехбуквенные варианты уже были заняты.
На придумывание не ушло много времени, я выбрал &lt;code class=&quot;highlighter-rouge&quot;&gt;vtvz&lt;/code&gt;. Вскоре, это стало моим логином/URL’ом/ником везде:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://vk.com/vtvz_ru&quot;&gt;https://vk.com/vtvz_ru&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.facebook.com/vtvz.ru&quot;&gt;https://www.facebook.com/vtvz.ru&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.linkedin.com/in/vtvz/&quot;&gt;https://www.linkedin.com/in/vtvz/&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;mailto:vtvz.ru@gmail.com&quot;&gt;vtvz.ru@gmail.com&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;mailto:vtvz@pm.me&quot;&gt;vtvz@pm.me&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://steamcommunity.com/id/vtvz_ru&quot;&gt;https://steamcommunity.com/id/vtvz_ru&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;Minecraft username: vtvz&lt;/li&gt;
  &lt;li&gt;Моя подпись (да, все зашло слишком далеко :grin:)&lt;/li&gt;
  &lt;li&gt;и т.д.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Даже WiFi сеть и Bluetooth у меня обозваны ссылкой на сайт:&lt;/p&gt;

&lt;figure class=&quot;frame&quot;&gt;
  &lt;img src=&quot;wifi.png&quot; alt=&quot;Название wifi сети: vtvz.ru&quot; /&gt;
&lt;/figure&gt;

&lt;p&gt;До появления блога, когда существовала только визитка, на сайт приходили люди из разных городов и даже стран.
Сложно сказать, сколько именно пришло из-за никнейма, но однозначно такие люди есть.
Наверняка из всех 497 посетителей по “прямому заходу” (вбил руками в бразуезе) есть те, кому было любопытно,
что скрывается под ником-ссылкой.&lt;/p&gt;

&lt;h2 id=&quot;поисковики&quot;&gt;Поисковики&lt;/h2&gt;

&lt;p&gt;На текущий момент, мой сайт не часто попадает в поисковые выдачи, и кликов приходит не так много.
Это вполне себе логично, так как:&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;Сайт сравнительно молодой. (6 лет это мало?)&lt;/li&gt;
  &lt;li&gt;На нем не так много контента.&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;С точки зрения SEO у меня почти всё сделано по последним канонам продвижения, но некоторые прорехи есть,
которые устранить сложнее. Но, как мне сказали, это и может ускорить поднятие в списке выдачи, но самое главное – это контент.
Тут есть проблемы… За этот год вышло всего шесть статей (эта седьмая), что не есть айс.&lt;/p&gt;

&lt;p&gt;Но есть определенная закономерность: узконаправленные статьи, решающие конкретную проблему,
гораздо чаще попадают в результаты поиска.&lt;/p&gt;

&lt;figure class=&quot;frame&quot;&gt;
  &lt;img src=&quot;google-console.png&quot; alt=&quot;Google Search Console&quot; /&gt;
&lt;/figure&gt;

&lt;p&gt;Гуглу, кстати говоря, я понравился больше. За этот год он показал меня аж 611 раз! Вот страницы-рекордсмены:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;/blog/html-to-mysql/&quot;&gt;“HTML to MySQL. Или Веб-скрапинг на практике”&lt;/a&gt; – 426 показов / 3 клика;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;/blog/jekyll-spoiler-plugin/&quot;&gt;“Jekyll Spoiler Plugin. Куда и как прятать код”&lt;/a&gt; – 75 показов / 3 клика;&lt;/li&gt;
  &lt;li&gt;И (внезапно) &lt;a href=&quot;/&quot;&gt;главная страница&lt;/a&gt; и &lt;a href=&quot;/blog/openning/&quot;&gt;“Свершилось! Часть первая. Зачем мне блог”&lt;/a&gt; – 129 показов / 1 + 1 клик;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Самые популярные запросы [в скобочках количество показов]:&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;скрапинг [65] / веб скрапинг [32] / скрапинг это [16] / веб-скрапинг [8] / скрапинг публичных сайтов [2]&lt;/li&gt;
  &lt;li&gt;vtvz [32] (Как так?)&lt;/li&gt;
  &lt;li&gt;markdown spoiler [11] / код спойлера [8]&lt;/li&gt;
&lt;/ol&gt;

&lt;details class=&quot;spoiler&quot;&gt;&lt;summary class=&quot;spoiler-title&quot;&gt;Небольшое замечание&lt;/summary&gt;&lt;div class=&quot;spoiler-body&quot;&gt;
&lt;p&gt;У Гугла статистика по запросам и по страницам очень сильно расходится.
Тогда как он показал мне суммарно 8 кликов из поисковика на вкладке “Страницы”, 
на вкладке “Запросы” нет &lt;strong&gt;ни одного клика (!)&lt;/strong&gt;.&lt;/p&gt;

&lt;p&gt;Может я что-то упускаю, но очень бы хотелось знать, по каким запросам пришли люди на сайт.&lt;/p&gt;

&lt;div class=&quot;row&quot;&gt;
    &lt;div class=&quot;col-sm-6&quot;&gt;
        &lt;figure&gt;&lt;a href=&quot;./google-console-queues.png&quot; target=&quot;_blank&quot;&gt;&lt;img src=&quot;./google-console-queues.png&quot; alt=&quot;Статистика по запросам&quot; /&gt;&lt;/a&gt;&lt;/figure&gt;
    &lt;/div&gt;
    &lt;div class=&quot;col-sm-6&quot;&gt;
        &lt;figure&gt;&lt;a href=&quot;./google-console-pages.png&quot; target=&quot;_blank&quot;&gt;&lt;img src=&quot;./google-console-pages.png&quot; alt=&quot;Статистика по страницам&quot; /&gt;&lt;/a&gt;&lt;/figure&gt;
    &lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;/details&gt;

&lt;p&gt;По поводу третьего пункта все ясно – решенная мной задача скорее уникальная, чем распространенная.&lt;/p&gt;

&lt;p&gt;Но почему скрапинг? Тема вроде как достаточно известная. Может быть материала на эту тему действительно мало?
Возможно это моя золотая жила? Надо исследовать в эту сторону :grin:&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;Касательно Яндекса… Может быть в нем контенгент немного другой.
Как правило, программисты пользуются Гуглом для поиска решений своих проблем.
Возможно именно поэтому за год я появлялся в выборке всего 63 раза. Это примерно в 10 раз меньше, чем Гугл.&lt;/p&gt;

&lt;p&gt;Яндекс тоже не особо многословен:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;виталий заславский – 6 показов;&lt;/li&gt;
  &lt;li&gt;заславский виталий – 4 показа;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Стоит отметить, что 6+4≠63. Куда делись остальные 53 показа?&lt;/p&gt;

&lt;details class=&quot;spoiler&quot;&gt;&lt;summary class=&quot;spoiler-title&quot;&gt;Кстати об этом...&lt;/summary&gt;&lt;div class=&quot;spoiler-body&quot;&gt;
&lt;p&gt;Статистика у него тоже неплохо так расходится. Опять же, возможно я что-то упускаю?&lt;/p&gt;

&lt;div class=&quot;row&quot;&gt;
    &lt;div class=&quot;col-sm-4&quot;&gt;
        &lt;figure&gt;&lt;a href=&quot;./yandex-groups.png&quot; target=&quot;_blank&quot;&gt;&lt;img src=&quot;./yandex-groups.png&quot; alt=&quot;Статистика по группам&quot; /&gt;&lt;/a&gt;&lt;/figure&gt;
    &lt;/div&gt;
    &lt;div class=&quot;col-sm-4&quot;&gt;
        &lt;figure&gt;&lt;a href=&quot;./yandex-pages.png&quot; target=&quot;_blank&quot;&gt;&lt;img src=&quot;./yandex-pages.png&quot; alt=&quot;Статистика страниц&quot; /&gt;&lt;/a&gt;&lt;/figure&gt;
    &lt;/div&gt;
    &lt;div class=&quot;col-sm-4&quot;&gt;
        &lt;figure&gt;&lt;a href=&quot;./yandex-popular.png&quot; target=&quot;_blank&quot;&gt;&lt;img src=&quot;./yandex-popular.png&quot; alt=&quot;Статистика по популярным запросам&quot; /&gt;&lt;/a&gt;&lt;/figure&gt;
    &lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;/details&gt;

&lt;p&gt;Мне еще много чего нужно сделать, чтобы поисковики и люди полюбили мой сайт:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;Дублировать статьи в &lt;a href=&quot;https://zen.yandex.ru/&quot;&gt;Yandex.Zen&lt;/a&gt;;&lt;/li&gt;
  &lt;li&gt;Подключить &lt;a href=&quot;https://yandex.ru/dev/turbo/&quot;&gt;Турбо-страницы&lt;/a&gt;;&lt;/li&gt;
  &lt;li&gt;Сделать &lt;a href=&quot;https://developers.google.com/amp/?hl=ru&quot;&gt;AMP версии страниц&lt;/a&gt;;&lt;/li&gt;
  &lt;li&gt;На главную страницу расположить список последних постов;&lt;/li&gt;
  &lt;li&gt;И еще много всякого разного…&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Но мой &lt;a href=&quot;https://www.facebook.com/ifrolov2&quot;&gt;коллега&lt;/a&gt;, который на продвижении уже собоку съел,
ясно дал понять, что ключ не в поисковых оптимизациях и прочей магии, а в контенте.
Так что самая важная для меня задача – писать больше статей.&lt;/p&gt;

&lt;h2 id=&quot;социальные-сети&quot;&gt;Социальные сети&lt;/h2&gt;

&lt;p&gt;В какой-то степени, социальные сети являются основным стабильным источником трафика.
За последний год из соц. сетей было 155 посещений, 122 которых пришлось на ВК (&lt;a href=&quot;https://vk.com/blog_vtvz&quot;&gt;кстати об этом&lt;/a&gt;).&lt;/p&gt;

&lt;p&gt;Откровенно говоря, мой блог хоть и обо всем, но целевая аудитория – IT-инженеры.
И тут получается некоторый конфликт: я хочу писать технические статьи, но их особо никто читать не будет,
потому основной поток читателей приходится из социальных сетей, где в друзьях у меня люди другой направленности.&lt;/p&gt;

&lt;p&gt;Тем не менее, большое спасибо тем, кто приходит, и особенно тем, кто дочитывает до конца. Для меня это важно :blush:&lt;/p&gt;

&lt;h2 id=&quot;дайджесты&quot;&gt;Дайджесты&lt;/h2&gt;

&lt;p&gt;Дайджест – это некоторый агрегатор интересных материалов по определенной тематике за какой-то период.&lt;/p&gt;

&lt;p&gt;Есть 2 основных дайджеста, в которые я потенциально мог попасть:
&lt;a href=&quot;https://habr.com/ru/users/pronskiy/posts/&quot;&gt;PHP-Дайджест&lt;/a&gt;
и &lt;a href=&quot;https://habr.com/ru/users/alexzfort/posts/&quot;&gt;Фронтенд дайджест&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Первая статья, которая попала в массы – &lt;a href=&quot;/blog/html-to-mysql/&quot;&gt;“HTML to MySQL. Или Веб-скрапинг на практике”&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;И она не попала ни в один из перечисленных выше дайджестов. Когда я отправил ссылку одному из авторов этих подборок,
мне дали ясно понять, что эта статья не уровня Хабра. Но, как оказалось позднее, у этих ребят есть еще свой &lt;a href=&quot;https://zfort.com.ua/&quot;&gt;сайт&lt;/a&gt;,
куда они тоже публикуют дайджесты, куда мне &lt;a href=&quot;https://zfort.com.ua/blog/category/digest/frontend-daidzhest-353-18-24-fevralya-2019&quot;&gt;удалось попасть&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;В итоге, за все это время мне удалось собрать 16 переходов. Не очень много, но это уже приятно :blush:&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;Самой успешной оказалась статья &lt;a href=&quot;/blog/custom-doctrine-annotation-fixer/&quot;&gt;“Пишем свой Doctrine Annotation Fixer для PHP-CS-Fixer”&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Это было именно то, что по всем критериям попадало в PHP-Дайджест:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Она напрямую связана с PHP;&lt;/li&gt;
  &lt;li&gt;Она уникальна в своем роде, так как существующие статьи уже устарели, подобная проблема не решалась, а материалов на русском найти невозможно;&lt;/li&gt;
  &lt;li&gt;Статья достаточно подробная, чтобы было понятно новичку, но без лишней воды, чтобы уже опытным было интересно.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Откровенно говоря, она и была написана с целью попасть в &lt;a href=&quot;https://habr.com/ru/post/477318/&quot;&gt;этот дайджест&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Более ста визитов за одну неделю и 171 за все время. И целых 2 комментария!
Цифры пока еще достаточно скромные, но, определенно, это прорыв! Для меня это настоящий успех! :tada:&lt;/p&gt;

&lt;figure&gt;&lt;a href=&quot;./success.png&quot; target=&quot;_blank&quot;&gt;&lt;img src=&quot;./success.png&quot; alt=&quot;Статистика визитов за неделю&quot; /&gt;&lt;/a&gt;&lt;/figure&gt;

&lt;p&gt;Самое приятное в этой ситуации то, что на сайт приходили не просто люди, а целевая аудитория – те, для кого была написана эта статья.&lt;/p&gt;

&lt;p&gt;Вероятно, это моя первая и последняя статья, которая попала в подобную подборку.
Просто потому, что я не нашел подходящих дайджестов по моим текущим направлениям (DevOps и немного Go).&lt;/p&gt;

&lt;h2 id=&quot;итого&quot;&gt;Итого&lt;/h2&gt;

&lt;p&gt;Сложно делать какие-то выводы. Цель этой статьи не в том, чтобы кого-то чему-то научить.
У меня произошло радостное событие, и я хотел с вами им поделиться :blush:&lt;/p&gt;

&lt;p&gt;Писать статьи – очень трудоемкий процесс, который я, возможно, опишу в отдельной статье. 
Поэтому спасибо всем, кто дочитал до конца; статья вышла достаточно большой.
Для меня ценно каждое посещение, каждый просмотр.&lt;/p&gt;

&lt;p&gt;Гляди, может быть наберется аудитория преданных читателей :grin:&lt;/p&gt;</content><author><name>Виталий Заславский</name><email>vtvz@pm.me</email></author><category term="Веб-разработка" /><category term="Блог" /><summary type="html">Мой блог, как мой питомец. Я его люблю, вкладываю туда свои время и силы. Для создания чего-то нового приходится тратить свой творческий ресурс. Да, даже чисто техническая статья должна быть интересной, неоднотонной, без повторяющихся слов, грамотной, корректной и другие страшные слова. Потратив этот ресурс, так или иначе хочется, чтобы это творение не осталось незамеченным. Художники делают выставки, музыканты записывают треки, танцоры выступают на концертах и т.д. А авторы статей и блогеры хотят, чтобы их читали. Хоть мой блог и был создал в первую очередь для меня, мне все равно не хочется писать впустую, а каждое посещение странички греет мне сердце. Тут коротко о моих первых успехах в продвижении сайта.</summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="https://vtvz.ru/assets/images/logo-black.png" /><media:content medium="image" url="https://vtvz.ru/assets/images/logo-black.png" xmlns:media="http://search.yahoo.com/mrss/" /></entry><entry><title type="html">Пишем свой Doctrine Annotation Fixer для PHP-CS-Fixer</title><link href="https://vtvz.ru/blog/custom-doctrine-annotation-fixer/" rel="alternate" type="text/html" title="Пишем свой Doctrine Annotation Fixer для PHP-CS-Fixer" /><published>2019-11-06T00:00:00+03:00</published><updated>2019-11-06T00:00:00+03:00</updated><id>https://vtvz.ru/blog/custom-doctrine-annotation-fixer</id><content type="html" xml:base="https://vtvz.ru/blog/custom-doctrine-annotation-fixer/">&lt;p&gt;В плане код-стайла я немного маньяк.
Я убежден – чем более строгие правила, тем качественнее будет кодовая база.
Когда я только пришел в компанию &lt;a href=&quot;https://axmit.com/&quot;&gt;Axmit&lt;/a&gt; в качестве разработчика,
моей личной целью стало создание перечня правил, а также настройка всякого рода фиксеров и снифферов.
Теперь у нас используется как &lt;a href=&quot;https://github.com/squizlabs/PHP_CodeSniffer&quot;&gt;CodeSniffer&lt;/a&gt;, так и &lt;a href=&quot;https://github.com/FriendsOfPHP/PHP-CS-Fixer&quot;&gt;PHP-CS-Fixer&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Большинство правил у нас автоматизированы &lt;a href=&quot;https://www.jetbrains.com/phpstorm/&quot;&gt;PHPStorm&lt;/a&gt; и &lt;a href=&quot;https://github.com/FriendsOfPHP/PHP-CS-Fixer&quot;&gt;PHP-CS-Fixer&lt;/a&gt;,
поэтому следование им не создает слишком много боли.&lt;/p&gt;

&lt;p&gt;Но был момент, который не был ни в одном из этих инструментов, заставляюший меня страдать.&lt;/p&gt;

&lt;!--cut--&gt;

&lt;p&gt;Все дело в Doctrine аннотациях. Шторм с ними ничего не делает совсем.
А вот фиксер имеет ряд правил, исправляющих отступы, скобочки и т.п.&lt;/p&gt;

&lt;p&gt;А вот в чем была проблема. Обратите внимание на запятые.&lt;/p&gt;

&lt;div class=&quot;language-php highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;cd&quot;&gt;/**
 * @SWG\Definition(
 *     definition=&quot;ActionFilterRequest&quot;,
 *     @SWG\Property(property=&quot;service_id&quot;, type=&quot;integer&quot;)
 * )
 */&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;div class=&quot;language-php highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;cd&quot;&gt;/**
 * @SWG\Definition(
 *     definition=&quot;ActionFilterRequest&quot;,
 *     @SWG\Property(property=&quot;service_id&quot;, type=&quot;integer&quot;,),
 * )
 */&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Эти оба куска абсолютно идентичны с точки зрения Доктрины.
И нет ни одного фиксера (по крайней мере я не нашел), который расставит все запятые по своим местам.
Вручную следить за этим достаточно сложно. Поэтому решено было написать своё правило.&lt;/p&gt;

&lt;p&gt;Я хочу, чтобы на выходе после исправления это было так:&lt;/p&gt;

&lt;div class=&quot;language-php highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;cd&quot;&gt;/**
 * @SWG\Definition(
 *     definition=&quot;ActionFilterRequest&quot;,
 *     @SWG\Property(property=&quot;service_id&quot;, type=&quot;integer&quot;),
 * )
 */&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;То есть точно также, как с массивами:
при однострочной записи без запятой в конце последнего элемента,
а при многострочной – с.&lt;/p&gt;

&lt;p&gt;И так, приступим!&lt;/p&gt;

&lt;h2 id=&quot;исследование&quot;&gt;Исследование&lt;/h2&gt;

&lt;p&gt;Внутри библиотеки все фиксеры для доктриновских аннотаций унаследованы от класса &lt;code class=&quot;highlighter-rouge&quot;&gt;\PhpCsFixer\AbstractDoctrineAnnotationFixer&lt;/code&gt;
с одним единственным абстрактным методом &lt;code class=&quot;highlighter-rouge&quot;&gt;fixAnnotations&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;Исследовав другие фиксеры ближе, можно увидеть, что в этот метод передается только один параметр – коллекция токенов.
Эта коллекция мутабельная и результат её изменений будет использоваться для формирования итогового кода.&lt;/p&gt;

&lt;p&gt;Минимально возможный фиксер, который пока ничего не делает, выглядит примерно так:&lt;/p&gt;

&lt;div class=&quot;language-php highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c1&quot;&gt;//  Тут есть пара неиспользуемых импортов, но скоро они будут нужны&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;use&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;Doctrine\Common\Annotations\DocLexer&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;use&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;PhpCsFixer\AbstractDoctrineAnnotationFixer&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;use&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;PhpCsFixer\Doctrine\Annotation\Token&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;use&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;PhpCsFixer\Doctrine\Annotation\Tokens&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;use&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;PhpCsFixer\FixerDefinition\FixerDefinition&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;use&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;PhpCsFixer\FixerDefinition\FixerDefinitionInterface&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;DoctrineAnnotationCommasFixer&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;AbstractDoctrineAnnotationFixer&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;cd&quot;&gt;/**
     * @return string
     */&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;getName&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;string&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;static&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;cd&quot;&gt;/**
     * @return string
     */&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;string&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'Axmit/doctrine_annotation_commas'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;cd&quot;&gt;/**
     * @return FixerDefinitionInterface
     */&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;getDefinition&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;FixerDefinitionInterface&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;FixerDefinition&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'Fixes commas in Doctrine annotations'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[]);&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;cd&quot;&gt;/**
     * Fixes Doctrine annotations from the given PHPDoc style comment.
     *
     * @param Tokens $tokens
     *
     * @return void
     */&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;protected&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;fixAnnotations&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Tokens&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$tokens&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;void&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Обратите особое внимание на методы &lt;code class=&quot;highlighter-rouge&quot;&gt;name&lt;/code&gt; и &lt;code class=&quot;highlighter-rouge&quot;&gt;getName&lt;/code&gt;.
Имя фиксера должно быть строго в таком формате, иначе будет ошибка
(регулярки можно посмотреть в &lt;code class=&quot;highlighter-rouge&quot;&gt;\PhpCsFixer\FixerNameValidator::isValid&lt;/code&gt;).
Статическим методом &lt;code class=&quot;highlighter-rouge&quot;&gt;name&lt;/code&gt; воспользуемся чуть позже.&lt;/p&gt;

&lt;p&gt;Дабы не нагромождать статью простынями кода, все остальные куски исходников будут внутри метода &lt;code class=&quot;highlighter-rouge&quot;&gt;fixAnnotations&lt;/code&gt;.&lt;/p&gt;

&lt;h2 id=&quot;регистрация&quot;&gt;Регистрация&lt;/h2&gt;

&lt;p&gt;Чтобы понять, как заставить фиксер включить моё правило потребовался почти час.
Для того, чтобы все заработало, нужно сделать 2 вещи:&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;Зарегистрировать фиксер в конфиге (файл &lt;code class=&quot;highlighter-rouge&quot;&gt;.php_cs.dist&lt;/code&gt;):
    &lt;div class=&quot;language-php highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$config&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;registerCustomFixers&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;([&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;DoctrineAnnotationCommasFixer&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()])&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
    &lt;p&gt;Теперь фиксер знает о существовании этого правила, но пока не использует его.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;Включить его в рулзах:
    &lt;div class=&quot;language-php highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$config&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;setRules&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;
        &lt;span class=&quot;nx&quot;&gt;DoctrineAnnotationCommasFixer&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// помните статический метод name? :-)&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
  &lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;И только тогда фиксер не только подключит это правило, но и будет его использовать.&lt;/p&gt;

&lt;h2 id=&quot;исправление&quot;&gt;Исправление&lt;/h2&gt;

&lt;p&gt;Настало время написать логику и оживить наш фикс!&lt;/p&gt;

&lt;p&gt;Если описать словами, то суть такова:&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;Найти все закрывающие обычные и фигурные скобки;&lt;/li&gt;
  &lt;li&gt;Посмотреть, что перед ними:
    &lt;ol&gt;
      &lt;li&gt;Если это пустота (игнорируемый код), то добавить перед ней запятую, если запятой нет;&lt;/li&gt;
      &lt;li&gt;Если это запятая – удалить&lt;/li&gt;
    &lt;/ol&gt;
  &lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;По коллекции токенов можно пройтись циклом, как по массиву.
Но мы этого делать не будем по причине, которую я объясню позже.&lt;/p&gt;

&lt;div class=&quot;language-php highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$index&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$tokens&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;offsetExists&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$index&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;cd&quot;&gt;/** @var Token $token */&lt;/span&gt;
    &lt;span class=&quot;nv&quot;&gt;$token&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$tokens&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;offsetGet&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$index&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

    &lt;span class=&quot;c1&quot;&gt;//TODO Add logic here &lt;/span&gt;

    &lt;span class=&quot;nv&quot;&gt;$index&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Класс &lt;code class=&quot;highlighter-rouge&quot;&gt;Token&lt;/code&gt; имеет 2 важных свойства – это тип и содержимое.
Тип является числовым значением, все из которых находятся в классе &lt;code class=&quot;highlighter-rouge&quot;&gt;DocLexer&lt;/code&gt; в виде констант.&lt;/p&gt;

&lt;p&gt;Проверить тип токена можно методом &lt;code class=&quot;highlighter-rouge&quot;&gt;isType&lt;/code&gt;, куда можно передать либо одно значение, либо массив:&lt;/p&gt;

&lt;div class=&quot;language-php highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$token&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;isType&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;([&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;DocLexer&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;T_CLOSE_CURLY_BRACES&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;DocLexer&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;T_CLOSE_PARENTHESIS&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]);&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;С первым пунктом разобрались – мы нашли все закрывающие скобки.
Далее нужно вытянуть 2 токена перед текущим:&lt;/p&gt;

&lt;div class=&quot;language-php highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$prevToken&lt;/span&gt;     &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$tokens&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;offsetGet&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$index&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$prevPrevToken&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$tokens&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;offsetGet&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$index&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Далее просто: если предыдущий токен – ничего 
(это могут быть пробелы, переносы строк и знак * в любом порядке и количестве;
стоит отметить, что в коллекции 2 токена “ничего” подряд не бывает),
и токен перед ним не является запятой, то нужно добавить запятую:&lt;/p&gt;

&lt;div class=&quot;language-php highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$prevToken&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;isType&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;DocLexer&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;T_NONE&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$prevPrevToken&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;isType&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;DocLexer&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;T_COMMA&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nv&quot;&gt;$tokens&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;insertAt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$index&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;Token&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;DocLexer&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;T_COMMA&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;','&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;));&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Иначе, если сразу перед скобкой стоит запятая – убрать:&lt;/p&gt;

&lt;div class=&quot;language-php highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;elseif&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$prevToken&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;isType&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;DocLexer&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;T_COMMA&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nv&quot;&gt;$prevToken&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;clear&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;И вроде бы уже все, но если попробовать запустить фиксер с этим правилом, он никогда не завершит свою работу.
Проблема кроется там, где мы добавляем запятую – программа уходит в бесконечный цикл.
Чтобы решить эту проблему, достаточно добавить еще один &lt;code class=&quot;highlighter-rouge&quot;&gt;$index++&lt;/code&gt; после добавления запятой:&lt;/p&gt;

&lt;div class=&quot;language-php highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$prevToken&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;isType&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;DocLexer&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;T_NONE&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$prevPrevToken&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;isType&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;DocLexer&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;T_COMMA&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nv&quot;&gt;$tokens&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;insertAt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$index&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;Token&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;DocLexer&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;T_COMMA&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;','&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;));&lt;/span&gt;
    &lt;span class=&quot;nv&quot;&gt;$index&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// причина, по которой нужен был цикл while вместо for&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;И все! Фиксер готов, можно выдохнуть :grin:&lt;/p&gt;

&lt;details class=&quot;spoiler&quot;&gt;&lt;summary class=&quot;spoiler-title&quot;&gt;Собрав все воедино&lt;/summary&gt;&lt;div class=&quot;spoiler-body&quot;&gt;
&lt;div class=&quot;language-php highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;cp&quot;&gt;&amp;lt;?php&lt;/span&gt;

&lt;span class=&quot;kn&quot;&gt;use&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;Doctrine\Common\Annotations\DocLexer&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;use&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;PhpCsFixer\AbstractDoctrineAnnotationFixer&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;use&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;PhpCsFixer\Doctrine\Annotation\Token&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;use&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;PhpCsFixer\Doctrine\Annotation\Tokens&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;use&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;PhpCsFixer\FixerDefinition\FixerDefinition&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;use&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;PhpCsFixer\FixerDefinition\FixerDefinitionInterface&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;DoctrineAnnotationCommasFixer&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;AbstractDoctrineAnnotationFixer&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;cd&quot;&gt;/**
     * @return string
     */&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;getName&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;string&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;static&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;cd&quot;&gt;/**
     * @return string
     */&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;string&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'Axmit/doctrine_annotation_commas'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;cd&quot;&gt;/**
     * @return FixerDefinitionInterface
     */&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;getDefinition&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;FixerDefinitionInterface&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;FixerDefinition&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'Fixes commas in Doctrine annotations'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[]);&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;cd&quot;&gt;/**
     * Fixes Doctrine annotations from the given PHPDoc style comment.
     *
     * @param Tokens $tokens
     *
     * @return void
     */&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;protected&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;fixAnnotations&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Tokens&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$tokens&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;void&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;nv&quot;&gt;$index&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$tokens&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;offsetExists&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$index&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;cd&quot;&gt;/** @var Token $token */&lt;/span&gt;
            &lt;span class=&quot;nv&quot;&gt;$token&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$tokens&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;offsetGet&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$index&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

            &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$token&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;isType&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;([&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;DocLexer&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;T_CLOSE_CURLY_BRACES&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;DocLexer&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;T_CLOSE_PARENTHESIS&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]))&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;nv&quot;&gt;$prevToken&lt;/span&gt;     &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$tokens&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;offsetGet&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$index&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
                &lt;span class=&quot;nv&quot;&gt;$prevPrevToken&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$tokens&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;offsetGet&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$index&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
                &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$prevToken&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;isType&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;DocLexer&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;T_NONE&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$prevPrevToken&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;isType&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;DocLexer&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;T_COMMA&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
                    &lt;span class=&quot;nv&quot;&gt;$tokens&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;insertAt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$index&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;Token&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;DocLexer&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;T_COMMA&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;','&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;));&lt;/span&gt;
                    &lt;span class=&quot;nv&quot;&gt;$index&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// prevent infinite loop&lt;/span&gt;
                &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;elseif&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$prevToken&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;isType&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;DocLexer&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;T_COMMA&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
                    &lt;span class=&quot;nv&quot;&gt;$prevToken&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;clear&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
                &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
            &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

            &lt;span class=&quot;nv&quot;&gt;$index&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;/div&gt;&lt;/details&gt;

&lt;h2 id=&quot;послесловие&quot;&gt;Послесловие&lt;/h2&gt;

&lt;p&gt;Тут стоит отметить пару моментов:&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;Если вы, как и я, пользуетесь PHPStorm, то вы могли увидеть, что классы &lt;code class=&quot;highlighter-rouge&quot;&gt;AbstractDoctrineAnnotationFixer&lt;/code&gt;, &lt;code class=&quot;highlighter-rouge&quot;&gt;Token&lt;/code&gt; и &lt;code class=&quot;highlighter-rouge&quot;&gt;Tokens&lt;/code&gt; зачеркнуты.
А происходит это по простой причине – они помечены как внутренние тегом &lt;code class=&quot;highlighter-rouge&quot;&gt;@internal&lt;/code&gt;.
Для нас это означает то, что наш фикс может сломаться в любой момент даже между минорными версиями,
так как никто не обещает стабильного API во внутреннем коде.
(на момент написания статьи использовался &lt;code class=&quot;highlighter-rouge&quot;&gt;friendsofphp/php-cs-fixer:v2.15.1&lt;/code&gt;)
Так что… все на свой страх и риск.&lt;/li&gt;
  &lt;li&gt;Тесты… Я уверен, что для этого можно и нужно писать тесты, в том числе и для проверки совместимости с новой версией фиксера,
но делать я этого не стал.
Просто потому что не нашел это необходимым в данный момент.
Возможно, я с этим разберусь и дополню текущую или напишу новую статью.&lt;/li&gt;
  &lt;li&gt;Потенциально написанное мной правило может работать не так в каких-то крайних случаях.
Но я прогнал его по двум нашим проектам, где более &lt;strong&gt;&lt;nobr&gt;2500 (!)&lt;/nobr&gt;&lt;/strong&gt; вложенных друг в друга аннотаций,
и он расставил запятые во все места и не испортил ни единого файла.
Поэтому я считаю этот вариант вполне себе рабочим и проверенным.&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;Спасибо за прочтение! :blush:&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;P.S. Внизу, после поста, появился блок с комментариями.
Не стесняйтесь задавать вопросы и указывать на ошибки и неточности.
Я всегда рад коммуникации :wink:&lt;/p&gt;</content><author><name>Виталий Заславский</name><email>vtvz@pm.me</email></author><category term="Веб-разработка" /><category term="PHP" /><category term="Code-style" /><summary type="html">В плане код-стайла я немного маньяк. Я убежден – чем более строгие правила, тем качественнее будет кодовая база. Когда я только пришел в компанию Axmit в качестве разработчика, моей личной целью стало создание перечня правил, а также настройка всякого рода фиксеров и снифферов. Теперь у нас используется как CodeSniffer, так и PHP-CS-Fixer. Большинство правил у нас автоматизированы PHPStorm и PHP-CS-Fixer, поэтому следование им не создает слишком много боли. Но был момент, который не был ни в одном из этих инструментов, заставляюший меня страдать.</summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="https://vtvz.ru/assets/images/logo-black.png" /><media:content medium="image" url="https://vtvz.ru/assets/images/logo-black.png" xmlns:media="http://search.yahoo.com/mrss/" /></entry><entry><title type="html">Как правильно хранить пароли</title><link href="https://vtvz.ru/blog/right-way-to-store-passwords/" rel="alternate" type="text/html" title="Как правильно хранить пароли" /><published>2019-11-03T00:00:00+03:00</published><updated>2019-11-03T00:00:00+03:00</updated><id>https://vtvz.ru/blog/right-way-to-store-passwords</id><content type="html" xml:base="https://vtvz.ru/blog/right-way-to-store-passwords/">&lt;blockquote&gt;
  &lt;p&gt;Начало 07.10.2019. Статья обещает быть обширной.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;Моим первым паролем был &lt;em&gt;“хахаха”&lt;/em&gt;. Не даром в ВК меня быстренько взломали.
Затем у меня был один пароль на все случаи жизни. Инцидентов не было, но метод далек от идеального.
Стоит узнать один пароль, как учетные записи других сервисов окажутся под угрозой. 
Следующим шагом был пароль, состоящий из двух частей: общим префиксом и доменным именем сайта.
Могло это выглядеть примерно так: &lt;em&gt;“МойСуперМощныйПароль123.vk.com”&lt;/em&gt;. Это все ещё очень плохо.&lt;/p&gt;

&lt;p&gt;Я рос. Росла и моя паранойя. Сейчас у меня для каждого отдельного сайта или приложения свой уникальный, неповторимый,
устойчивый к атакам пароль.&lt;/p&gt;

&lt;p&gt;В этой статье я расскажу, как правильно хранить свои пароли, чтобы было удобно, и безопасность не страдала.&lt;/p&gt;

&lt;!--cut--&gt;

&lt;details class=&quot;spoiler&quot;&gt;&lt;summary class=&quot;spoiler-title&quot;&gt;TL;DR&lt;/summary&gt;&lt;div class=&quot;spoiler-body&quot;&gt;
&lt;p&gt;Можно пропустить первый подзаголовок и сразу перейти к &lt;a href=&quot;#рецепт&quot;&gt;готовому рецепту&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Но тогда вы пропустите самое интересное :blush:&lt;/p&gt;
&lt;/div&gt;&lt;/details&gt;

&lt;h2 id=&quot;об-альтернативных-способах&quot;&gt;Об альтернативных способах&lt;/h2&gt;

&lt;p&gt;Небольшое лирическое отступление. Прежде хочется рассказать о том, как другие люди хранят свои пароли.&lt;/p&gt;

&lt;p&gt;Про один пароль для всего и общую приставку я уже рассказал. Так делал не только я. Но есть более диковинные способы.&lt;/p&gt;

&lt;p&gt;Вместе с каждым способом будут субъективные ответы на 2 вопроса:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;em&gt;“Безопасно ли это”&lt;/em&gt; – как много людей и как легко они могут узнать пароли из этого источника.&lt;/li&gt;
  &lt;li&gt;&lt;em&gt;“Надежно ли это”&lt;/em&gt; – что будет в чрезвычайных ситуациях; насколько легко можно потерять доступ ко всему.&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;бумажный-блокнотик&quot;&gt;Бумажный блокнотик&lt;/h3&gt;

&lt;p&gt;Так делают, но обычно люди преклонного возраста. Небольшая книжечка с различного рода записями,
где в разных частях можно увидеть пароль от WiFi, Play Store или Одноклассников.
Помимо блокнотиков используется со всех сторон исписанный листочек или даже упаковка от таблеток &lt;em&gt;*[TODO Сделать фото]&lt;/em&gt;.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;em&gt;Безопасно ли это?&lt;/em&gt; Условно. Однозначно, что пароль не будет стянут каким-либо хакером, так как доступ только физический.
Можно ли доверять всем, кто может оказаться рядом? Если ты бабушка, то рисковать особо нечем :blush:&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;em&gt;Надежно ли это?&lt;/em&gt; Опять же, очень ситуативно. Бумажка может потеряться, сгореть или забыться.
Зато нет риска потерять доступ к сервису в случае амнезии. &lt;br /&gt;
(Пожалуй, это единственный способ устойчивый к амнезии)&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;онлайн-заметки&quot;&gt;Онлайн-заметки&lt;/h3&gt;

&lt;p&gt;Из хорошо известных заметочных сервисов, я знаю только &lt;a href=&quot;https://evernote.com/intl/ru&quot;&gt;Evernote&lt;/a&gt; и &lt;a href=&quot;https://keep.google.com/&quot;&gt;Google Keep&lt;/a&gt;.
Последним я стал пользоваться в году так 2013, когда он был совсем еще юным.
(первый мне не понравился).
Есть еще всякие Google Docs и прочие места, куда можно писать текст и читать его со всех устройств.
Пароли можно хранить и там. Но…&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;em&gt;Безопасно ли это?&lt;/em&gt; Вариант с бумажкой был куда более безопасным. Хранить пароли в открытом виде очень даже плохо по нескольким причинам:
    &lt;ol&gt;
      &lt;li&gt;Есть только один способ, как узнать пароль из блокнота – стащить сам блокнот.
  Но есть &lt;code class=&quot;highlighter-rouge&quot;&gt;N&lt;/code&gt; способов, как узнать его из подобного рода сервисов – 
  &lt;code class=&quot;highlighter-rouge&quot;&gt;X&lt;/code&gt; по количеству устройств + &lt;code class=&quot;highlighter-rouge&quot;&gt;Y&lt;/code&gt; по количеству заинтересованных хакеров + &lt;code class=&quot;highlighter-rouge&quot;&gt;Z&lt;/code&gt; по количеству “забыл выйти у друга”.&lt;/li&gt;
      &lt;li&gt;Любая утечка и &lt;strong&gt;все&lt;/strong&gt; пароли буду скомпрометированы. Как веб-разработчик могу уверенно сказать: никому нельзя доверять.
  Даже если используются все способы того, как обезопасить свои заметки,
  всегда есть человеческий фактор как с вашей стороны, так и со стороны создателей сервиса.&lt;/li&gt;
    &lt;/ol&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;em&gt;Надежно ли это?&lt;/em&gt; Достаточно. Но с одной оговоркой: сервис должен поддерживать историю изменений файла/заметки.
Иначе любое случайное удаление/редактирование может уничтожить все.&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;пароль-карта&quot;&gt;Пароль-карта&lt;/h3&gt;

&lt;p&gt;Есть еще один интересный способ – пароль-карта. Это может быть физически реальный объект или приложение на телефоне.&lt;/p&gt;

&lt;p&gt;Вот пример, сгенерированный на &lt;a href=&quot;https://www.passwordcard.org/ru&quot;&gt;этом сайте&lt;/a&gt;:&lt;/p&gt;

&lt;figure&gt;&lt;img src=&quot;./card.png&quot; alt=&quot;Пароль-карта&quot; /&gt;&lt;/figure&gt;

&lt;p&gt;Или вот &lt;a href=&quot;https://www.e-passwordcard.com/&quot;&gt;многообещающее приложение&lt;/a&gt;:&lt;/p&gt;

&lt;figure&gt;&lt;img src=&quot;./ecard.png&quot; alt=&quot;Еще одна пароль-карта&quot; /&gt;&lt;/figure&gt;

&lt;p&gt;Вторым приложением я не пользовался, но картой пытался.
Достаточно удобно то, что это может быть 
как настоящая распечатанная карточка,
так и приложение на телефоне или ссылка, сохраненная в браузере.&lt;/p&gt;

&lt;p&gt;Для этого метода важно помнить и надежно хранить 2 вещи:&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;Мастер-ключ (или мастер-пароль – пароль для доступа ко всем паролям).
В случае с первой картой он является &lt;code class=&quot;highlighter-rouge&quot;&gt;e1b18dd6f30ed2f5&lt;/code&gt; (написан в самом низу), 
который можно записать куда угодно, но в безопасное место.
Вводя этот ключ в специальное поле, будет выдана одна и та же карта, что необходимо в случае утери онной.&lt;/li&gt;
  &lt;li&gt;Нужно запоминать способ, как вытягивается пароль. Это может быть простая ассоциация со значком,
где потом используются все символы подряд. Или что-то более замысловатое.
На &lt;a href=&quot;https://www.passwordcard.org/ru&quot;&gt;сайте&lt;/a&gt; есть инструкции и рекомендации, как выбирать пароли, чтобы было безопасно.&lt;/li&gt;
&lt;/ol&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;em&gt;Безопасно ли это?&lt;/em&gt; Все зависит только от тебя. Чем сложнее способ извлечения пароля, тем надежнее он будет.
Дополнительно надежности дает то, что нельзя наверняка сопоставить значок на карте и сам сервис.
Даже при утере карточки, новый обладатель вряд ли догадается, что с ней делать.&lt;/li&gt;
  &lt;li&gt;&lt;em&gt;Надежно ли это?&lt;/em&gt; Вполне. Мастер-ключ можно записать в несколько мест:
в онлайн-заметки, в блокнотик, нацарапать на стене за диваном.
Карта может быть восстановлена в любое время.
Сложнее, когда забывается ассоциация со значком или способ выбора пароля.
В этом плане этот метод имеет серьезный недостаток, из-за чего лично я отказался от его использования.&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;онлайн-сервисы&quot;&gt;Онлайн сервисы&lt;/h3&gt;

&lt;p&gt;Такие сайты-приложения как &lt;a href=&quot;https://www.lastpass.com/ru&quot;&gt;LastPass&lt;/a&gt; и &lt;a href=&quot;https://1password.com/ru/&quot;&gt;1password&lt;/a&gt; предлагают взять весь менеджмент паролей на себя.
Это как хранить данные в онлайн-заметках, только надежнее. Второй аж прям обещает, что ваши данные остаются только вашими.&lt;/p&gt;

&lt;figure&gt;&lt;img src=&quot;./1password-promise.png&quot; alt=&quot;Обещание 1password&quot; /&gt;&lt;/figure&gt;

&lt;p&gt;Эти сервисы богаты функционалом и предлагаемыми решениями:
программы и приложения для всех ОС, расширения для браузеров и API для тех, кому этого мало.&lt;/p&gt;

&lt;p&gt;Но есть одно &lt;strong&gt;НО&lt;/strong&gt;: любая информация в интернете вам не принадлежит. Хотя они и обещают полную конфиденциальность,
в определенный момент это может стать не так. Это касается различных законов со стороны государства, а также хакеров,
которые денно и нощно придумывают все новые и новые способы обхода защиты подобных сайтов.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;em&gt;Безопасно ли это?&lt;/em&gt; Достаточно, но с оговорками. Для обычного пользователя, у которого нет паранойи и особо нечего скрывать,
это наилучший выбор. Сами компании не заинтересованы, чтобы ваши данные утекли кому-то еще, так как это репутация,
которая играет важную роль на конкурентном рынке. Главное, чтобы эти данные не утекли из-за вас самих.
Пароль должен быть достаточно сложным и длинным, чтобы даже в случае утечки данных их нельзя было расшифровать.&lt;/li&gt;
  &lt;li&gt;&lt;em&gt;Надежно ли это?&lt;/em&gt; Настолько, насколько надежна компания, которой вы доверяете.
Я думаю, ваши данные не только надежно хранятся и оберегаются, но и регулярно делаются резервные копии на случай какого-либо сбоя.
Из всех вышеперечисленных способов, этот самый надежный. Приятным бонусом является то, что знать достаточно только один пароль.&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;keepass&quot;&gt;KeePass&lt;/h3&gt;

&lt;p&gt;В мире много умных людей, которые сталкивались с этой проблемой.
И они создали по-настоящему хорошее решение.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Встречайте: KeePass!&lt;/strong&gt;&lt;/p&gt;

&lt;figure&gt;&lt;a href=&quot;./keepass.png&quot; target=&quot;_blank&quot;&gt;&lt;img src=&quot;./keepass.png&quot; alt=&quot;KeePassXC&quot; /&gt;&lt;/a&gt;&lt;/figure&gt;

&lt;p&gt;Это последний и самый лучший способ хранения паролей, который нужно уметь готовить.&lt;/p&gt;

&lt;p&gt;Это одновременно программа, формат файла и алгоритм безопасного хранения данных.
Все ваши пароли хранятся внутри &lt;code class=&quot;highlighter-rouge&quot;&gt;.kdbx&lt;/code&gt; файла, который зашифрован в цикле несколько тысяч (а то и больше) раз
кодовым словом, файлом или и тем и другим.&lt;/p&gt;

&lt;p&gt;Информация хранится понятным вам способом, в доверенном месте, там, где удобнее всего.
Прежде, чем я расскажу о плюсах и минусах этого подхода, хочу описать, каким образом и где хранятся мои пароли.&lt;/p&gt;

&lt;h2 id=&quot;рецепт&quot;&gt;Рецепт&lt;/h2&gt;

&lt;p&gt;Так как я активный пользователь ОС Linux и Android, моё решение будет заточено в первую очередь под мои потребности и ограничения.&lt;/p&gt;

&lt;h3 id=&quot;выбор-программного-обеспечения&quot;&gt;Выбор программного обеспечения&lt;/h3&gt;

&lt;p&gt;Для пользователей Windows стандартом является официальный клиент &lt;a href=&quot;https://keepass.info/&quot;&gt;KeePass&lt;/a&gt;,
который имеет тонну &lt;a href=&quot;https://keepass.info/plugins.html&quot;&gt;плагинов и дополнений&lt;/a&gt;.
Его тоже &lt;a href=&quot;https://keepass.info/help/v2/setup.html#mono&quot;&gt;можно&lt;/a&gt; запустить на Linux и Mac OS, но у меня это выглядело весьма уродливо.
Поэтому мой выбор пал на &lt;a href=&quot;https://keepassxc.org/&quot;&gt;KeePassXC&lt;/a&gt;.
Он является &lt;acronym title=&quot;С английского fork (дословно англ. 'вилка') использование одного проекта в качестве основы другого&quot;&gt;форком&lt;/acronym&gt;
&lt;a href=&quot;https://www.keepassx.org/&quot;&gt;KeePassX&lt;/a&gt; (буквы “C” нет)
с внушительным списком дополнительных возможностей.&lt;/p&gt;

&lt;p&gt;В качестве клиента для Android выбор пал на &lt;a href=&quot;https://play.google.com/store/apps/details?id=keepass2android.keepass2android&amp;amp;hl=ru&quot;&gt;Keepass2Android&lt;/a&gt;.
Для iOS есть какой-то &lt;a href=&quot;https://apps.apple.com/ru/app/keepass-touch/id966759076&quot;&gt;KeePass Touch&lt;/a&gt;, который тоже умеет синхронизироваться с Dropbox, но я им не пользовался,
поэтому и осознанно порекомендовать ничего не могу.&lt;/p&gt;

&lt;p&gt;В качестве хранилища использую &lt;a href=&quot;https://www.dropbox.com/&quot;&gt;Dropbox&lt;/a&gt;, потому что для Linux есть клиент,
который синхронизирует файлы с теми, что лежат на компе,
что дает возможность пользоваться одной базой на нескольких устройствах.
Также &lt;a href=&quot;https://play.google.com/store/apps/details?id=keepass2android.keepass2android&amp;amp;hl=ru&quot;&gt;Keepass2Android&lt;/a&gt; умеет работать с хранилищем почти напрямую.&lt;/p&gt;

&lt;p&gt;Если совсем кратко:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://keepass.info/&quot;&gt;KeePass&lt;/a&gt; или &lt;a href=&quot;https://keepassxc.org/&quot;&gt;KeePassXC&lt;/a&gt; для ПК.&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://play.google.com/store/apps/details?id=keepass2android.keepass2android&amp;amp;hl=ru&quot;&gt;Keepass2Android&lt;/a&gt; или &lt;a href=&quot;https://apps.apple.com/ru/app/keepass-touch/id966759076&quot;&gt;KeePass Touch&lt;/a&gt; для мобильных устройств.&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.dropbox.com/&quot;&gt;Dropbox&lt;/a&gt; как хранилище.&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;ложка-дегтя&quot;&gt;Ложка дегтя&lt;/h3&gt;

&lt;p&gt;При всей красоте этого варианта, он не лишен недостатков:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Один пароль от всего является как преимуществом, так и недостатком.
Стоит злоумышленнику стащить мастер-пароль, &lt;strong&gt;всё&lt;/strong&gt;, что вы так бережно хранили, окажется под угрозой.
Например это значит, что в публичных местах, типа кафе, библиотек и торговых центров, можно засветить пароль на камеру.&lt;/li&gt;
  &lt;li&gt;Хранение базы в Dropbox может казаться хорошей идеей, если бы не одно НО: он хранит старые версии файла в течение 30 дней.
(насколько я знаю, почистить историю файла можно только при удалении самого файла… не очень удобно)
Это значит, что менять мастер-пароль чаще, чем раз в 30 дней – не есть хорошая идея.
Самое лучшее – хранить файл на своем сервере, что позволить и даже осилить может не каждый.&lt;/li&gt;
&lt;/ul&gt;
&lt;details class=&quot;spoiler&quot;&gt;&lt;summary class=&quot;spoiler-title&quot;&gt;Журнал версий моего файла с паролями&lt;/summary&gt;&lt;div class=&quot;spoiler-body&quot;&gt;
&lt;figure&gt;&lt;img src=&quot;./file-history.png&quot; alt=&quot;Журнал версий файла с паролями&quot; /&gt;&lt;/figure&gt;
&lt;/div&gt;&lt;/details&gt;
&lt;ul&gt;
  &lt;li&gt;Помимо этого, нужно помнить как минимум 2 пароля: от Dropbox и от хранилища.
И они должны быть достаточно сложными, надежными и &lt;strong&gt;разными&lt;/strong&gt;.
(а еще нужно помнить пароль от телефона, пинкоды от всех банковских карт и т.д.)&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Приходится мириться с этими условностями, чтобы, получив достаточную безопасность, не потерять и удобство использования.
До идеала в этой схеме не хватает выделенного доверенного хранилища и регулярной смены мастер-пароля.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;em&gt;Безопасно ли это?&lt;/em&gt; Из всех вариантов, этот самый лучший.
Его может осилить любой, кто хоть как-то владеет компьютером и смартфоном.
При этом данные принадлежат только вам… пока вы сохраняете бдительность и осторожность.&lt;/li&gt;
  &lt;li&gt;&lt;em&gt;Надежно ли это?&lt;/em&gt; Файл с паролями будет храниться на всех устройствах, куда вы подключите Dropbox, а так же в самом Dropbox’e.
Бо́льшую надежность, я думаю, не предоставит никто.&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;бочка-мёда&quot;&gt;Бочка мёда&lt;/h3&gt;

&lt;p&gt;Но минусы очень хорошо перевешиваются плюсами:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Подобные программы разработаны быть устойчивыми к вирусам. Из браузера стащить пароль может любое расширение.
Из программы – только человек.&lt;/li&gt;
  &lt;li&gt;Если все правильно настроить, программа самостоятельно заблокирует хранилище с паролями в течение N минут бездействия.
Это защищает от случаев “отошел от компа, но забыл заблокировать”.&lt;/li&gt;
  &lt;li&gt;В случае приложения для Android, есть возможность разблокировать хранилище последними несколькими символами пароля.
Очень удобно и достаточно безопасно – дается всего одна попытка и наступает полная блокировка, где нужно ввести кодовую фразу целиком.&lt;/li&gt;
  &lt;li&gt;Еще раз про это приложение: оно позволяет вводить пароли из встроенной в него клавиатурой.
Это значит, что пароль не окажется в буфере обмена и его невозможно будет стащить таким образом.&lt;/li&gt;
  &lt;li&gt;Приложения для ПК имеют функцию автоввода: ставишь курсор на поле с логином, открываешь приложение,
находишь нужную запись, жмешь комбинацию клавиш (обычно &lt;kbd&gt;Ctrl+V&lt;/kbd&gt;) и вуоля – все данные введены за вас.
Если последовательность действий для сайта отличается от классической, то ее можно настроить прямо в записи.&lt;/li&gt;
  &lt;li&gt;Если пароль скопировать, то буфер обмена автоматически будет очищен через определенный промежуток времени.&lt;/li&gt;
  &lt;li&gt;Возможно сохранить секретное слово для двух-этапной аутентификации (TOTP, Steam Guard) и копировать его прямиком из менеджера паролей.
(&lt;kbd&gt;Ctrl+T&lt;/kbd&gt; в случае &lt;a href=&quot;https://keepassxc.org/&quot;&gt;KeePassXC&lt;/a&gt;)&lt;/li&gt;
  &lt;li&gt;Встроенные возможности:
    &lt;ul&gt;
      &lt;li&gt;Генератор паролей;&lt;/li&gt;
      &lt;li&gt;Примечания и дополнительные атрибуты;&lt;/li&gt;
      &lt;li&gt;Ссылка на сайт с возможностью открыть прямо из программы;&lt;/li&gt;
      &lt;li&gt;Вложения в виде файлов;&lt;/li&gt;
      &lt;li&gt;Значок к записи (KeePassXC может скачивать значок с сайта, а с &lt;a href=&quot;https://keepassxc.org/blog/2019-10-26-2.5.0-released/&quot;&gt;последним обновлением&lt;/a&gt; для нескольких записей);&lt;/li&gt;
      &lt;li&gt;История изменений и корзина;&lt;/li&gt;
      &lt;li&gt;Напоминание о необходимости изменить пароль;&lt;/li&gt;
      &lt;li&gt;Вложенные папки;&lt;/li&gt;
      &lt;li&gt;И много всего еще…&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;hr /&gt;

&lt;p&gt;Вывод очевиден: &lt;strong&gt;храните свои пароли правильно&lt;/strong&gt;.
Никто из вас не заинтересован быть взломанными,
поэтому воспользуйтесь любым безопасным и надежным способом хранения ваших данных.
Я надеюсь, эта статья дала понимание существующей проблемы и её решения,
и вы прислушаетесь к моим советам вам же во благо :blush:&lt;/p&gt;</content><author><name>Виталий Заславский</name><email>vtvz@pm.me</email></author><category term="Программы" /><category term="Сервисы" /><category term="Безопасность" /><summary type="html">Начало 07.10.2019. Статья обещает быть обширной. Моим первым паролем был “хахаха”. Не даром в ВК меня быстренько взломали. Затем у меня был один пароль на все случаи жизни. Инцидентов не было, но метод далек от идеального. Стоит узнать один пароль, как учетные записи других сервисов окажутся под угрозой. Следующим шагом был пароль, состоящий из двух частей: общим префиксом и доменным именем сайта. Могло это выглядеть примерно так: “МойСуперМощныйПароль123.vk.com”. Это все ещё очень плохо. Я рос. Росла и моя паранойя. Сейчас у меня для каждого отдельного сайта или приложения свой уникальный, неповторимый, устойчивый к атакам пароль. В этой статье я расскажу, как правильно хранить свои пароли, чтобы было удобно, и безопасность не страдала.</summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="https://vtvz.ru/assets/images/logo-black.png" /><media:content medium="image" url="https://vtvz.ru/assets/images/logo-black.png" xmlns:media="http://search.yahoo.com/mrss/" /></entry><entry><title type="html">Платить или не платить. Или зачем нужны стриминговые платформы</title><link href="https://vtvz.ru/blog/why-audio-streaming-platforms/" rel="alternate" type="text/html" title="Платить или не платить. Или зачем нужны стриминговые платформы" /><published>2019-10-07T00:00:00+03:00</published><updated>2019-10-07T00:00:00+03:00</updated><id>https://vtvz.ru/blog/why-audio-streaming-platforms</id><content type="html" xml:base="https://vtvz.ru/blog/why-audio-streaming-platforms/">&lt;p&gt;Как-то исторически сложилось, что после того, как в ВК стали активно внедрять меры по защите авторских прав, 
платных подписок и прочие ограничения на прослушиваине музыки, я перешел на &lt;a href=&quot;https://music.yandex.ru/&quot;&gt;Яндекс.Музыку&lt;/a&gt;,
в качестве основного источника музыкального дофамина.&lt;/p&gt;

&lt;p&gt;До этого были активные попытки использовать &lt;a href=&quot;https://play.google.com/music&quot;&gt;Google Music&lt;/a&gt;, но приложение оказалось тяжелым (в техническом плане),
запутанным и не удобным для использования.&lt;/p&gt;

&lt;p&gt;Через какое-то время была куплена подписка за 99р. в месяц, потом полноценная в &lt;nobr&gt;169р/м&lt;/nobr&gt;, 
а в итоге семейная за &lt;nobr&gt;300р/м&lt;/nobr&gt; на 4 человека.&lt;/p&gt;

&lt;p&gt;Сравнение музыкальных сервисов будет в следующей статье.
А в этой хочу рассказать, почему лучше выбрать один из них, чем пользоваться ВК, и почему они стоят своих денег.&lt;/p&gt;

&lt;!--cut--&gt;
&lt;h2 id=&quot;всех-людей-можно-разделить-на&quot;&gt;Всех людей можно разделить на…&lt;/h2&gt;

&lt;p&gt;Метод, который работает. Через разделение людей на категории можно выявить плюсы и минусы различных подходов. Так вот. Всех людей можно разделить на…&lt;/p&gt;

&lt;h3 id=&quot;пираты&quot;&gt;Пираты!&lt;/h3&gt;

&lt;p&gt;Огромный пласт людей, которых можно охарактеризовать, как “старые пираты”. 
Вся их музыка хранится на компе, аккуратно (или нет) распихана по папочкам, 
избранные треки скачиваются на телефон для дальнейшего прослушивания до дыр.&lt;/p&gt;

&lt;p&gt;Библиотеки таких меломанов могут занимать десятки, 
а то и сотни гигабайт дискового пространства полностью скачанными дискографиями любимых исполнителей с какого-нибудь торрента,
которые обновляются достаточно редко, а любимые треки перестают быть любимыми, потому что от них уже тошнит.
Новые исполнители появляются достаточно редко и обычно в результате случайно найденных в ВК треков или по рекомендации друзей.
Этот подход мне напоминает времена, когда на телефонах с ИК портом было всего 19мб памяти. 
Ты скачиваешь всего один трек в течение полу часа, а потом в течение месяца случаешь одно и то же.&lt;/p&gt;

&lt;p&gt;Недостатки такого подхода очевидны – библиотека треков устаревает, хранится обычно в одном месте, 
которое может исчезнуть в результате случайного технического сбоя,
пополнения нет, о рекомендациях и упоминать не стоит.&lt;/p&gt;

&lt;p&gt;Плюсы: оно бесплатно. И идеально подходит для параноиков, которые не сидят в обычных соц. сетях, а весь трафик пропускают через Tor.&lt;/p&gt;

&lt;h3 id=&quot;халявщики&quot;&gt;Халявщики&lt;/h3&gt;

&lt;p&gt;Этот тип отличается от пиратов тем, что в большинстве случаев они используют что-то бесплатное, но официально доступное.
Не скажу, что это неправильно, и людей этого типа большинство. Такие люди пользуются бесплатными возможностями музыкальных сервисов 
и готовы мириться с теми ограничениями, которые накладывает на них “халява”.&lt;/p&gt;

&lt;p&gt;Такими неудобствами являются ограничения на количество переключений на следующий трек в час (обычно около шести),
невозможность прослушать конкретного автора или композицию, ограниченное время прослушивание в фоновом режиме,
ограничение по качеству звука, реклама и отсутствие возможности слушать оффлайн.
Обычно это применимо только к мобильным и десктопным приложениям.
Прослушивание же онлайн на сайте у большинства сервисов не накладывает практически никаких ограничений.&lt;/p&gt;

&lt;p&gt;Почти все халявщики являются псевдо-пиратами. В основном они готовы терпеть неудобства,
но иногда прибегают к тем же торрентам, пиратским сайтам 
и различного рода расширениям и приложениям для скачивания треков.
Откровенно говоря, даже не-халявщикам приходится это делать, потому что:&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;Поставить трек на вызов нельзя;&lt;/li&gt;
  &lt;li&gt;Слушать музыку оффлайн без телефона не всегда получится;&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;Также у некоторых сервисов есть ломанные клиенты (у Яндекс.Музыки, например),
которые снимают все ограничения бесплатного тарифа.
И в этот момент грань между пиратами и халявщиками начинает стираться.&lt;/p&gt;

&lt;details class=&quot;spoiler&quot;&gt;&lt;summary class=&quot;spoiler-title&quot;&gt;Кстати&lt;/summary&gt;&lt;div class=&quot;spoiler-body&quot;&gt;
&lt;p&gt;Хоть я и плачу́ денежку за музыку, сам иногда пользуюсь вот &lt;a href=&quot;http://ytdl-org.github.io/youtube-dl/&quot;&gt;этой мощной тулзой&lt;/a&gt;,
которая умеет скачивать не только видео с Youtube, но и целиком альбомы и плейлисты с Яндекс.Музыки.&lt;/p&gt;

&lt;p&gt;Иногда это бывает просто необходимо :expressionless:&lt;/p&gt;
&lt;/div&gt;&lt;/details&gt;

&lt;h3 id=&quot;остальные&quot;&gt;Остальные&lt;/h3&gt;

&lt;p&gt;Тот небольшой процент людей, которые готовы платить деньги за то, что им нравится. Но об этом потом.&lt;/p&gt;

&lt;h2 id=&quot;почему-вконтакте&quot;&gt;Почему ВКонтакте?&lt;/h2&gt;

&lt;p&gt;Дурову нужно отдать должное – он создал по-настоящему удобную и хорошо спроектированную социальную сеть.
Да, она не лишена недостатков, но в ней есть все, что нужно. И нет того мусора, которым полон Facebook.&lt;/p&gt;

&lt;p&gt;В ВК есть то, чего нет нигде: авторские треки, уникальные композиции, всяческие ремиксы и т.д.
Если что-то где-то появится, то это почти обязательно попадет в ВК через несколько минут после релиза.
Платные треки с &lt;a href=&quot;https://bandcamp.com/&quot;&gt;Bandcamp&lt;/a&gt; можно послушать за бесплатно.
Удобно обмениваться треками со своими друзьями (соц. сеть же!).
И с недавних пор там появились нормальные альбомы с обложками и п.р.&lt;/p&gt;

&lt;p&gt;Поиск треков осуществляется через друзей или через паблики, посвященные какому-то определенному направлению.&lt;/p&gt;

&lt;p&gt;И пока все было бесплатно, это был 100% выбор большинства русских, в том числе и меня.
Но Дурова не стало и в ВК настали смутные времена. И следующий вопрос стал как никогда актуален…&lt;/p&gt;

&lt;h2 id=&quot;почему-не-вконтакте&quot;&gt;Почему не ВКонтакте?&lt;/h2&gt;

&lt;p&gt;Давайте будем честными… Музыка в ВК – сплошная свалка.
Если попытаться провести поиск по автору, можно много чего обнаружить:&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;Десятки повторяющихся треков…&lt;/li&gt;
  &lt;li&gt;И их ремиксы;&lt;/li&gt;
  &lt;li&gt;А также треки не этого автора;&lt;/li&gt;
  &lt;li&gt;Нужный трек может быть на второй или третьей странице поиска.&lt;/li&gt;
  &lt;li&gt;Треки малопопулярных авторов с названием, состоящим из популярных английских слов найти сложно, 
потому что на выдаче все, что угодно, но не то, что нужно. А &lt;a href=&quot;https://music.yandex.ru/album/810866/track/7735656&quot;&gt;некоторых&lt;/a&gt; треков и вовсе нет.&lt;/li&gt;
  &lt;li&gt;Проблема с группами с пересекающимися названиями. Для примера: есть группа &lt;a href=&quot;https://ru.wikipedia.org/wiki/Red_(%D0%B3%D1%80%D1%83%D0%BF%D0%BF%D0%B0)&quot;&gt;Red&lt;/a&gt;, но ты ее не найдешь, потому что ВК выдаст “&lt;em&gt;Red&lt;/em&gt; Hot Chili Peppers”.&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;Структуры никакой: ни разбиения по авторам, ни тем более по альбомам.
И только фан-группы энтузиасты берут на себя эту ответственность и наводят более менее порядок.&lt;/p&gt;

&lt;p&gt;В определенный момент треки начали пачками удаляться из списков за нарушение авторских прав.
И вот тут наступили действительно тяжелые времена.&lt;/p&gt;

&lt;p&gt;Это было раньше, в тот момент, когда я перестал использовать ВК для музыки. 
Сейчас вроде лучше, как я вижу. Команда ВКонтакте очень постаралась привести порядок в этой куче мусора и не мусора,
а также заключить контракты с лейблами, чтобы не приходилось удалять все подряд.&lt;/p&gt;

&lt;p&gt;Но комон! Стоимость платной подписки ровно такая же, как и полная подписка в &lt;a href=&quot;https://music.yandex.ru/&quot;&gt;Яндекс.Музыке&lt;/a&gt; и &lt;a href=&quot;https://www.deezer.com/&quot;&gt;Deezer&lt;/a&gt;.
Веских причин использовать ВК у меня нет. Аргумент “у меня в ВК вся музыка” – не аргумент,
потому что почти везде есть либо встроенная функция импорта, либо сторонние инструменты,
которые могут перегнать список треков в плейлист.&lt;/p&gt;

&lt;p&gt;Система рекомендаций ВК работает очень слабо. Если вообще работает.
Решил попробовать “Специально для вас” – советует всякий треш, который я даже в фоне слушать не смогу.
В “Новинках” Артур Пирожков, в “Новых Альбомах” 4 из 5-ти с ненормативной лексикой и так далее…&lt;/p&gt;

&lt;p&gt;Я думаю, вы меня поняли. ВК не то место, куда я бы стал вкладывать свои средства.&lt;/p&gt;

&lt;h2 id=&quot;что-если-не-вконтакте&quot;&gt;Что, если не ВКонтакте?&lt;/h2&gt;

&lt;p&gt;Благо монополии тут нет и выбор достаточно велик:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.spotify.com/&quot;&gt;Spotify&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.deezer.com/&quot;&gt;Deezer&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://music.yandex.ru/&quot;&gt;Яндекс.Музыка&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://play.google.com/music&quot;&gt;Google Play Music&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.apple.com/ru/itunes/&quot;&gt;Apple iTunes&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://music.youtube.com/&quot;&gt;YouTube Music&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://soundcloud.com/&quot;&gt;SoundCloud&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://tidal.com/&quot;&gt;Tidal&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://zvuk.com/&quot;&gt;Zvooq&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Порядок сугубо произвольный и не отражает сути и приоритета.&lt;/p&gt;

&lt;h2 id=&quot;но-что-мне-выбрать&quot;&gt;Но что мне выбрать?&lt;/h2&gt;

&lt;p&gt;Об этом я расскажу в следующей статье, где подробно опишу опыт использования некоторых сервисов из списка выше,
и почему я выбрал именно &lt;a href=&quot;https://music.yandex.ru/&quot;&gt;Яндекс&lt;/a&gt;.&lt;/p&gt;

&lt;h2 id=&quot;нужно-ли-мне-что-то-выбирать&quot;&gt;Нужно ли мне что-то выбирать?&lt;/h2&gt;

&lt;p&gt;Нет. Но я настоятельно рекомендую выбрать продукт, который c самого зачатия затачивался под музыку.
К тому же после того, как в ВК ввели платные подписки, условия всех стриминговых платформ почти уравнялись,
и агрументов в пользу ВК почти не осталось, кроме тесной интеграции музыки с самой соц. сетью.&lt;/p&gt;

&lt;h2 id=&quot;зачем-платить-деньги-если-можно-и-бесплатно&quot;&gt;Зачем платить деньги, если можно и бесплатно?&lt;/h2&gt;

&lt;p&gt;На самом деле не нужно. Многими плюшками можно пользоваться не заплатив ни копейки. Это за вас сделает вездесущая реклама.&lt;/p&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;что-то-вроде-вывода&quot;&gt;Что-то вроде вывода&lt;/h2&gt;

&lt;p&gt;Необходимость в платной подписке обусловливается только Вашими потребностями и возможностями.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Нужна ли Вам музыка вне компьютера или оффлайн?&lt;/li&gt;
  &lt;li&gt;Есть ли у Вас возможность выделять 100-300 рублей на подписку?
&lt;small&gt;(если Вы можете позволить себе ходить раз в месяц в кафе, значит есть)&lt;/small&gt;&lt;/li&gt;
  &lt;li&gt;Нуждаетесь ли Вы в каком-либо механизме рекомендаций или готовых подборок?&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;В моем случае все ответы утвердительные.&lt;/p&gt;

&lt;p&gt;300 рублей – это тоже деньги, не могу сказать, что это мелочь.
Но благодаря этому 4 человека (могло быть и 6, но Яндекс жадина)
имеют доступ к большому музыкальному банку. Это 75 рублей с человека. 
Это меньше, чем заказать такси или купить 2 литра бензина,
и чуть больше, чем съездить на работу и обратно на автобусе.&lt;/p&gt;

&lt;p&gt;А пользу я и члены моей семьи ощущем каждый день по дороге с работы и обратно, на работе или в пути в другой город.&lt;/p&gt;

&lt;p&gt;В любом случае, любой из сервисов из списка предоставляет бесплатный (или очень дешевый) период без ограничений.
Попробуйте. Возможно понравится и Вам :blush:&lt;/p&gt;</content><author><name>Виталий Заславский</name><email>vtvz@pm.me</email></author><category term="Музыка" /><category term="Сервисы" /><summary type="html">Как-то исторически сложилось, что после того, как в ВК стали активно внедрять меры по защите авторских прав, платных подписок и прочие ограничения на прослушиваине музыки, я перешел на Яндекс.Музыку, в качестве основного источника музыкального дофамина. До этого были активные попытки использовать Google Music, но приложение оказалось тяжелым (в техническом плане), запутанным и не удобным для использования. Через какое-то время была куплена подписка за 99р. в месяц, потом полноценная в 169р/м, а в итоге семейная за 300р/м на 4 человека. Сравнение музыкальных сервисов будет в следующей статье. А в этой хочу рассказать, почему лучше выбрать один из них, чем пользоваться ВК, и почему они стоят своих денег.</summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="https://vtvz.ru/assets/images/logo-black.png" /><media:content medium="image" url="https://vtvz.ru/assets/images/logo-black.png" xmlns:media="http://search.yahoo.com/mrss/" /></entry><entry><title type="html">Jekyll Spoiler Plugin. Куда и как прятать код</title><link href="https://vtvz.ru/blog/jekyll-spoiler-plugin/" rel="alternate" type="text/html" title="Jekyll Spoiler Plugin. Куда и как прятать код" /><published>2019-03-08T00:00:00+03:00</published><updated>2019-03-08T00:00:00+03:00</updated><id>https://vtvz.ru/blog/jekyll-spoiler-plugin</id><content type="html" xml:base="https://vtvz.ru/blog/jekyll-spoiler-plugin/">&lt;p&gt;Когда писал &lt;a href=&quot;/blog/html-to-mysql/&quot;&gt;предыдущую статью&lt;/a&gt;, столкнулся с одной простой проблемой: большие куски кода занимали больше места, чем сам текст.&lt;/p&gt;

&lt;p&gt;Поиск готового решения для спойлеров привел меня на вот &lt;a href=&quot;https://burrowl.com/blog/2015/05/23/spoiler-block/&quot;&gt;эту страничку&lt;/a&gt;.
Решение простое и гениальное, но имело один большой недостаток: текст внутри спойлера не форматировался.&lt;/p&gt;

&lt;p&gt;Свое решение я опишу в этой статье.&lt;/p&gt;

&lt;!--cut--&gt;
&lt;details class=&quot;spoiler&quot;&gt;&lt;summary class=&quot;spoiler-title&quot;&gt;TL;DR. Для тех, кому лень читать целиком&lt;/summary&gt;&lt;div class=&quot;spoiler-body&quot;&gt;
&lt;p&gt;Это нужно положить в папку &lt;code class=&quot;highlighter-rouge&quot;&gt;_plugins&lt;/code&gt;:&lt;/p&gt;

&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;module&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;Jekyll&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;SpoilerBlock&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;Liquid&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;Block&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;initialize&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;tag_name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;markup&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;tokens&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
      &lt;span class=&quot;k&quot;&gt;super&lt;/span&gt;
      &lt;span class=&quot;vi&quot;&gt;@summary&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;markup&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;strip&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;render&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;context&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;site&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;context&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;registers&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;:site&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;converter&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;site&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;find_converter_instance&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;Jekyll&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;Converters&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;Markdown&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

      &lt;span class=&quot;n&quot;&gt;output&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'&amp;lt;details class=&quot;spoiler&quot;&amp;gt;'&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;output&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&amp;lt;summary class=&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;spoiler-title&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;#{&lt;/span&gt;&lt;span class=&quot;vi&quot;&gt;@summary&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;empty?&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;?&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'Открыть'&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;vi&quot;&gt;@summary&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;lt;/summary&amp;gt;&quot;&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;output&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'&amp;lt;div class=&quot;spoiler-body&quot;&amp;gt;'&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;output&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;converter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;convert&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;super&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;output&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'&amp;lt;/div&amp;gt;'&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;output&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'&amp;lt;/details&amp;gt;'&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

&lt;span class=&quot;no&quot;&gt;Liquid&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;Template&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;register_tag&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'spoiler'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;Jekyll&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;SpoilerBlock&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;И использовать в постах так:&lt;/p&gt;

&lt;div class=&quot;language-markdown highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;{% spoiler Заголовок спойлера %}
&lt;span class=&quot;p&quot;&gt;```&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;yaml
&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;content&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;some&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;string&quot;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;```&lt;/span&gt;
{% endspoiler %}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;/div&gt;&lt;/details&gt;

&lt;div class=&quot;alert alert-danger&quot; role=&quot;alert&quot;&gt;
    &lt;p&gt;&lt;b&gt;В Github Pages это работать не будет!&lt;/b&gt;&lt;/p&gt;
    &lt;p&gt;Любые плагины и дополнения работают только при самостоятельной сборке проекта (например, на Gitlab'е)&lt;/p&gt;
&lt;/div&gt;

&lt;h2 id=&quot;проблема&quot;&gt;Проблема&lt;/h2&gt;

&lt;p&gt;Если любой код поместить внутрь HTML тега, то он будет отрисован как есть. То есть вот этот кусок кода:&lt;/p&gt;

&lt;div class=&quot;language-html highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nt&quot;&gt;&amp;lt;details&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;spoiler&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;summary&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;spoiler-title&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;Заголовок спойлера&lt;span class=&quot;nt&quot;&gt;&amp;lt;/summary&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;div&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;spoiler-body&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
**Тут должен быть жирный текст**

```
А это *должен* быть кусок кода
```
&lt;span class=&quot;nt&quot;&gt;&amp;lt;/div&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;/details&amp;gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Выдаст вот такой результат:&lt;/p&gt;

&lt;details class=&quot;spoiler&quot;&gt;
    &lt;summary class=&quot;spoiler-title&quot;&gt;Заголовок спойлера&lt;/summary&gt;
    &lt;div class=&quot;spoiler-body&quot;&gt;
    **Тут должен быть жирный текст**
    
    ```
    А это *должен* быть кусок кода
    ```
    &lt;/div&gt;
&lt;/details&gt;

&lt;p&gt;Мы можем заставить Jekyll парсить код внутри HTML элементов:&lt;/p&gt;

&lt;div class=&quot;language-yaml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c1&quot;&gt;# _config.yml&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;kramdown&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;parse_block_html&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;true&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Но результат сильно лучше не станет:&lt;/p&gt;

&lt;figure class=&quot;frame&quot;&gt;
  &lt;img src=&quot;broken-html.png&quot; alt=&quot;Поехавшая разметка&quot; /&gt;
&lt;/figure&gt;

&lt;h2 id=&quot;решение&quot;&gt;Решение&lt;/h2&gt;

&lt;p&gt;Решение напрашивается само собой: нужно содержание спойлера индивидуально прогонять через конвертёр.&lt;/p&gt;

&lt;p&gt;Когда-то я читал спецификацию по Ruby, но для меня он до сей поры остается языком инопланетян.
(Говорят, что Ruby очень популярен в Японии. Кажется, это все объясняет).
Я даже кажется &lt;a href=&quot;https://github.com/jekyll/jekyll/blob/master/lib/jekyll/filters.rb#L16&quot;&gt;нашел&lt;/a&gt; используемый в Liquid фильтр для конвертации. Но так и не смог его победить.&lt;/p&gt;

&lt;p&gt;В итоге после короткого гугления нашел вот этот рецепт:&lt;/p&gt;

&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;site&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;context&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;registers&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;:site&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;converter&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;site&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;find_converter_instance&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;Jekyll&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;Converters&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;Markdown&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;converter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;convert&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;text&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Остается все это дело собрать воедино вот так:&lt;/p&gt;

&lt;details class=&quot;spoiler&quot;&gt;&lt;summary class=&quot;spoiler-title&quot;&gt;Все то же, что и в TL;DR выше&lt;/summary&gt;&lt;div class=&quot;spoiler-body&quot;&gt;
&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;module&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;Jekyll&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;SpoilerBlock&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;Liquid&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;Block&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;initialize&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;tag_name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;markup&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;tokens&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
      &lt;span class=&quot;k&quot;&gt;super&lt;/span&gt;
      &lt;span class=&quot;vi&quot;&gt;@summary&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;markup&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;strip&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;render&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;context&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;site&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;context&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;registers&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;:site&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;converter&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;site&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;find_converter_instance&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;Jekyll&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;Converters&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;Markdown&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

      &lt;span class=&quot;n&quot;&gt;output&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'&amp;lt;details class=&quot;spoiler&quot;&amp;gt;'&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;output&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&amp;lt;summary class=&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;spoiler-title&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;#{&lt;/span&gt;&lt;span class=&quot;vi&quot;&gt;@summary&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;empty?&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;?&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'Открыть'&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;vi&quot;&gt;@summary&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;lt;/summary&amp;gt;&quot;&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;output&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'&amp;lt;div class=&quot;spoiler-body&quot;&amp;gt;'&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;output&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;converter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;convert&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;super&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;output&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'&amp;lt;/div&amp;gt;'&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;output&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'&amp;lt;/details&amp;gt;'&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

&lt;span class=&quot;no&quot;&gt;Liquid&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;Template&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;register_tag&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'spoiler'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;Jekyll&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;SpoilerBlock&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;/div&gt;&lt;/details&gt;

&lt;p&gt;Положить в папку &lt;code class=&quot;highlighter-rouge&quot;&gt;_plugins&lt;/code&gt;. И далее можно использовать в любом Markdown документе вот так:&lt;/p&gt;

&lt;div class=&quot;language-markdown highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;{% spoiler Заголовок спойлера %}
&lt;span class=&quot;p&quot;&gt;```&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;yaml
&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;content&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;some&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;string&quot;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;```&lt;/span&gt;
{% endspoiler %}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Вот с таким вот результатом:&lt;/p&gt;

&lt;details class=&quot;spoiler&quot;&gt;&lt;summary class=&quot;spoiler-title&quot;&gt;Заголовок спойлера&lt;/summary&gt;&lt;div class=&quot;spoiler-body&quot;&gt;
&lt;div class=&quot;language-yaml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;na&quot;&gt;content&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;some&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;string&quot;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;/div&gt;&lt;/details&gt;

&lt;p&gt;Используйте на здоровье :grin:&lt;/p&gt;</content><author><name>Виталий Заславский</name><email>vtvz@pm.me</email></author><category term="Веб-разработка" /><category term="Jekyll" /><summary type="html">Когда писал предыдущую статью, столкнулся с одной простой проблемой: большие куски кода занимали больше места, чем сам текст. Поиск готового решения для спойлеров привел меня на вот эту страничку. Решение простое и гениальное, но имело один большой недостаток: текст внутри спойлера не форматировался. Свое решение я опишу в этой статье.</summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="https://vtvz.ru/assets/images/logo-black.png" /><media:content medium="image" url="https://vtvz.ru/assets/images/logo-black.png" xmlns:media="http://search.yahoo.com/mrss/" /></entry><entry><title type="html">HTML to MySQL. Или Веб-скрапинг на практике</title><link href="https://vtvz.ru/blog/html-to-mysql/" rel="alternate" type="text/html" title="HTML to MySQL. Или Веб-скрапинг на практике" /><published>2019-02-19T00:00:00+03:00</published><updated>2019-02-19T00:00:00+03:00</updated><id>https://vtvz.ru/blog/html-to-mysql</id><content type="html" xml:base="https://vtvz.ru/blog/html-to-mysql/">&lt;p&gt;Один мой хороший знакомый и коллега обратился ко мне за помощью. Он делал для одной компании новый сайт взамен старому.
Данные со старого, естественно, должны были переместиться на новый.
В этом и заключалась моя задача. Было только одно простое условие – доступа к БД старого сайта ни у меня, ни у него не было.&lt;/p&gt;

&lt;p&gt;В этой статье я хочу на практике показать, что можно сделать в этой ситуации, несмотря на отсутствие адекватной разметки в коде страницы.&lt;/p&gt;

&lt;!--cut--&gt;

&lt;p&gt;&lt;em&gt;// Не ждите высокотехнологичных мемуаров. 
Статья предназначена скорее для новичков среднего уровня, поэтому излишне подробная.
Но может быть и разработчики уровня повыше смогут найти для себя интересные подходы к решению описанной проблемы :blush:&lt;/em&gt;&lt;/p&gt;

&lt;h2 id=&quot;что-имеется&quot;&gt;Что имеется&lt;/h2&gt;

&lt;p&gt;Есть сайт с панелью администратора, доступной по логину-паролю, которые имеются, и около 1500 записей по 20 на страницу.&lt;/p&gt;

&lt;p&gt;Также есть доступ к БД через панель PhpMyAdmin. (На крайний случай есть SSH доступ, но это для очень больших объемов данных)&lt;/p&gt;

&lt;p&gt;Ну и на этом все.&lt;/p&gt;

&lt;p&gt;Работа единоразовая, поэтому писать целую инфраструктуру не требуется.&lt;/p&gt;

&lt;h2 id=&quot;инструменты&quot;&gt;Инструменты&lt;/h2&gt;

&lt;p&gt;Для таких задач мне не раз приходил на выручку NodeJs.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Во-первых, я его знаю и знаю достаточно хорошо.&lt;/li&gt;
  &lt;li&gt;Во-вторых, под него есть огромное количество библиотек, в том числе и для работы с HTML разметкой.&lt;/li&gt;
  &lt;li&gt;В-третьих, в случае большого количества данных запросы можно распараллелить и это даст значительный прирост к скорости выполнения скрипта. PHP так же может.&lt;/li&gt;
  &lt;li&gt;Ну и последнее, я уже не первый раз выполнял подобную работу и на бо́льших объемах и могу сказать, что лучше JS ничто не выполнит эту задачу лучше.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Так же в некоторых, в том числе и в этом, случаях приходится писать некоторые скрипты прямо в браузер. А там JS по умолчанию.&lt;/p&gt;

&lt;p&gt;Часто используемые библиотеки это:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://github.com/request/request&quot;&gt;request&lt;/a&gt; + &lt;a href=&quot;https://github.com/request/request-promise&quot;&gt;request-promise&lt;/a&gt;
которые в удобном виде умеют делать HTTP запросы и делают это хорошо. 
Можно было использовать встроенный http модуль, надстройкой которому является эта библиотека, 
но в request уже из коробки учтены такие мелочи, 
как использование http или https, обработка редиректов, сбор информации из буферов и стримов 
и прочее, чем обычно заниматься не хочется совсем. 
&lt;br /&gt;
В нашем случае она не понадобится, но обычно она незаменимый инструмент.&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://github.com/cheeriojs/cheerio&quot;&gt;cheerio&lt;/a&gt;
как удобная замена jQuery для NodeJs с идентичным интерфейсом. То, что доктор прописал.
Возможно, кто-то со мной не согласится и скажет, что есть что-то удобнее. И я скорее всего соглашусь.
Но я пользовался jQuery еще до того, как NodeJS, NPM и прочие появились.
Поэтому я использую его, потому что хорошо знаю и люблю.&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;шаг-первый-сбор-сырой-информации&quot;&gt;Шаг первый. Сбор сырой информации&lt;/h2&gt;

&lt;p&gt;Был у меня опыт вытягивания данных из новостной ленты одного сайта.
Это были публичные данные, поэтому собрать их не с труда любым способом. И я использовал &lt;code class=&quot;highlighter-rouge&quot;&gt;request&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;Тут ситуация немного другая – доступ был запаролен, скорее всего с помощью PHP сессий.
Быстрый эксперимент с подстановкой Cookie из браузера не дал положительного результата.
Возможно, да и скорее всего, я просто сделал что-то не так. Как бы то ни было я решил пойти другим путем.&lt;/p&gt;

&lt;p&gt;Оказалось проще вытянуть данные прямо в пределах браузера. На сайте уже использовался jQuery, так что пол дела уже сделано.&lt;/p&gt;

&lt;p&gt;Первая проверка на работоспособность прошла успешно:&lt;/p&gt;

&lt;div class=&quot;language-javascript highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;await&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;kd&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;http://example.ru/user/admin?page=1&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;// Да-да. jQuery умеет в Promise&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;И в консоль было выплюнуто корректное содержание запрошенной страницы. Это ведь то, что нам нужно!
Достаточно единожды пройтись по страничкам и собрать всю необходимую информацию:&lt;/p&gt;

&lt;div class=&quot;language-javascript highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;results&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[];&lt;/span&gt;
&lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;pages&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;73&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kd&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;pages&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;results&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;push&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;await&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;kd&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;http://example.ru/user/admin?page=&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;));&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;И Вуаля! В массиве &lt;code class=&quot;highlighter-rouge&quot;&gt;results&lt;/code&gt; лежат исходники всех 73 страниц.
Тут можно пойти двумя путями: работать с данными дальше в браузере
или сохранить их на комп и обрабатывать средствами NodeJs. Я выбрал второй. Так проще и быстрее.&lt;/p&gt;

&lt;p&gt;Поэтому следующая задача – сохранить данные в файл. Сделать это можно несколькими способами.
Я выбрал следующий: сформировать данные как строку и загрузить как файл.&lt;/p&gt;

&lt;p&gt;Гугление привело на &lt;a href=&quot;https://stackoverflow.com/questions/13405129/javascript-create-and-save-file&quot;&gt;эту страничку&lt;/a&gt; в StackOverflow, где был приведен вот этот сниппет:&lt;/p&gt;

&lt;div class=&quot;language-javascript highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c1&quot;&gt;// Function to download data to a file&lt;/span&gt;
&lt;span class=&quot;kd&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;download&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;filename&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;file&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;Blob&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;([&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;});&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;window&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;navigator&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;msSaveOrOpenBlob&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// IE10+&lt;/span&gt;
        &lt;span class=&quot;nb&quot;&gt;window&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;navigator&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;msSaveOrOpenBlob&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;file&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;filename&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// Others&lt;/span&gt;
        &lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;a&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;document&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;createElement&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;
                &lt;span class=&quot;nx&quot;&gt;url&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;URL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;createObjectURL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;file&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;nx&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;href&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;url&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;nx&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;download&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;filename&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;nb&quot;&gt;document&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;body&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;appendChild&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;nx&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;click&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
        &lt;span class=&quot;nx&quot;&gt;setTimeout&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kd&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;nb&quot;&gt;document&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;body&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;removeChild&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
            &lt;span class=&quot;nb&quot;&gt;window&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;URL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;revokeObjectURL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;url&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;  
        &lt;span class=&quot;p&quot;&gt;},&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt; 
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Не вдаваясь в подробности того, как это работает, скопировал этот код в консоль, и эта строчка:&lt;/p&gt;

&lt;div class=&quot;language-javascript highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nx&quot;&gt;download&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;JSON&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;stringify&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;results&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;data.json&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;application/json&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;предложит скачать все нами загруженные данные в виде обычного json файла.&lt;/p&gt;

&lt;p&gt;Сбор сырых данных завершен. Можно приступать к анализу.&lt;/p&gt;

&lt;h2 id=&quot;шаг-второй-анализ&quot;&gt;Шаг второй. Анализ&lt;/h2&gt;

&lt;p&gt;Каждая запись на странице внешне выглядит так:&lt;/p&gt;

&lt;figure class=&quot;frame&quot;&gt;
  &lt;img src=&quot;datum.png&quot; alt=&quot;Пример данных&quot; /&gt;
  &lt;figcaption&gt;Данные были намеренно искажены. Джонатан Хамстер – мой хомяк.&lt;/figcaption&gt;
&lt;/figure&gt;

&lt;p&gt;А HTML код вот такой:&lt;/p&gt;

&lt;div class=&quot;language-html highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nt&quot;&gt;&amp;lt;div&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;item&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;data-key=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;1494&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;hr&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;div&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;mb4 brown&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
        &lt;span class=&quot;nt&quot;&gt;&amp;lt;p&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;mt0&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
            &lt;span class=&quot;nt&quot;&gt;&amp;lt;span&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;grey&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;Имя:&lt;span class=&quot;nt&quot;&gt;&amp;lt;/span&amp;gt;&lt;/span&gt; Джонатан Хамстер
            &lt;span class=&quot;nt&quot;&gt;&amp;lt;a&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;href=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;/user/update-client?id=1494&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;ml2 size08 hover-nodecor hover-green&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
                &lt;span class=&quot;nt&quot;&gt;&amp;lt;img&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;src=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;/images/pencil.png&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;mr1 middle&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;изменить
            &lt;span class=&quot;nt&quot;&gt;&amp;lt;/a&amp;gt;&lt;/span&gt;
        &lt;span class=&quot;nt&quot;&gt;&amp;lt;/p&amp;gt;&lt;/span&gt;

        &lt;span class=&quot;nt&quot;&gt;&amp;lt;p&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;pull-right size08 grey&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;Заходил(а): 16.02.2019 17:38&lt;span class=&quot;nt&quot;&gt;&amp;lt;/p&amp;gt;&lt;/span&gt;

        &lt;span class=&quot;nt&quot;&gt;&amp;lt;p&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;mt1&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&amp;lt;span&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;grey&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;Тип:&lt;span class=&quot;nt&quot;&gt;&amp;lt;/span&amp;gt;&lt;/span&gt; Обычный покупатель&lt;span class=&quot;nt&quot;&gt;&amp;lt;/p&amp;gt;&lt;/span&gt;

        &lt;span class=&quot;nt&quot;&gt;&amp;lt;p&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;mt1&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&amp;lt;span&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;grey&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;До получения/продления скидки осталось:&lt;span class=&quot;nt&quot;&gt;&amp;lt;/span&amp;gt;&lt;/span&gt; 9000 руб.&lt;span class=&quot;nt&quot;&gt;&amp;lt;/p&amp;gt;&lt;/span&gt;

        &lt;span class=&quot;nt&quot;&gt;&amp;lt;p&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;mt1&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&amp;lt;span&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;grey&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;Email:&lt;span class=&quot;nt&quot;&gt;&amp;lt;/span&amp;gt;&lt;/span&gt; jonathan4@gmail.com&lt;span class=&quot;nt&quot;&gt;&amp;lt;/p&amp;gt;&lt;/span&gt;
        
        &lt;span class=&quot;nt&quot;&gt;&amp;lt;p&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;mt1&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&amp;lt;span&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;grey&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;Телефон:&lt;span class=&quot;nt&quot;&gt;&amp;lt;/span&amp;gt;&lt;/span&gt; 79507757757&lt;span class=&quot;nt&quot;&gt;&amp;lt;/p&amp;gt;&lt;/span&gt;
        
        &lt;span class=&quot;nt&quot;&gt;&amp;lt;p&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;mt1&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&amp;lt;span&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;grey&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;Адрес:&lt;span class=&quot;nt&quot;&gt;&amp;lt;/span&amp;gt;&lt;/span&gt; 111111 г. Москва, ул. Ленина, 28-123&lt;span class=&quot;nt&quot;&gt;&amp;lt;/p&amp;gt;&lt;/span&gt;

        &lt;span class=&quot;nt&quot;&gt;&amp;lt;p&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;mt1 size08&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&amp;lt;span&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;grey&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;Зарегистрирован(а):&lt;span class=&quot;nt&quot;&gt;&amp;lt;/span&amp;gt;&lt;/span&gt; 16.02.2019 17:12&lt;span class=&quot;nt&quot;&gt;&amp;lt;/p&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;/div&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;/div&amp;gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Выглядит ужасно даже после форматирования, но с этим можно работать.&lt;/p&gt;

&lt;p&gt;Если кратко прорезюмировать:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;Все элементы списка располагаются внутри &lt;code class=&quot;highlighter-rouge&quot;&gt;#centercolumn .list-view&lt;/code&gt;.
На самом деле все &lt;code class=&quot;highlighter-rouge&quot;&gt;.list-view&lt;/code&gt; появляется на странице единожды и нет никакой надобности уточнять его расположение.&lt;/li&gt;
  &lt;li&gt;Каждый элемент списка имеет класс &lt;code class=&quot;highlighter-rouge&quot;&gt;.item&lt;/code&gt;. Это важно, потому что внутри &lt;code class=&quot;highlighter-rouge&quot;&gt;.list-view&lt;/code&gt; еще есть информация о количестве записей (“Показаны записи 1-20 из 1462”) и пагинация.&lt;/li&gt;
  &lt;li&gt;Каждый кусочек данных располагается внутри элемента &lt;code class=&quot;highlighter-rouge&quot;&gt;p&lt;/code&gt;.&lt;/li&gt;
  &lt;li&gt;Каждый тип данных никак не отделяется классом. То есть внутри одинаковых элементов с одинаковыми классами лежат разные данные.&lt;/li&gt;
  &lt;li&gt;Внутри почти каждого параграфа есть элемент с классом &lt;code class=&quot;highlighter-rouge&quot;&gt;.grey&lt;/code&gt;, который и определяет тип.&lt;/li&gt;
  &lt;li&gt;Количество данных не консистентно – не во всех записях есть Email и Телефон.&lt;/li&gt;
  &lt;li&gt;Сами данные тоже не имеют какого-то стандарта.
Адрес записан в произвольном формате (есть случаи, где в качестве адреса указаны “F”, “SPb” или “………”).
Имя тоже не имеет единого формата (ФИО, ИФО, ИФ, ФИ, И, Магазин у “Моста”).&lt;/li&gt;
  &lt;li&gt;И самое главное: почти вся полезная информация лежит в тексте, который расположен именно внутри параграфа. То есть если убрать всех потомков и вытащить текст, мы получим то, что нужно.&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;шаг-третий-реализация&quot;&gt;Шаг третий. Реализация&lt;/h2&gt;

&lt;h3 id=&quot;получение-типов-данных&quot;&gt;Получение типов данных&lt;/h3&gt;

&lt;p&gt;Первое, что нужно выяснить, какие типы данных у нас в принципе имеются во всех записях.
Для этого можно вытянуть все &lt;code class=&quot;highlighter-rouge&quot;&gt;p .grey&lt;/code&gt; и найти уникальные значения.
В современном JS есть замечательный класс &lt;code class=&quot;highlighter-rouge&quot;&gt;Set&lt;/code&gt;, который хранит в себе набор уникальных значений.
Если добавить то, что уже есть, операция будет проигнорирована.&lt;/p&gt;

&lt;div class=&quot;language-javascript highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kd&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;cheerio&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;require&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;cheerio&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;kd&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;data&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;require&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;./data.json&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

&lt;span class=&quot;kd&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;main&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;async&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;types&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;Set&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
    
    &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kd&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;datum&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;of&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;kd&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;$&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;cheerio&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;load&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;datum&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

        &lt;span class=&quot;nx&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;.list-view .item&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;each&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;item&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;nx&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;item&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;find&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;p&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;each&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;item&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;kd&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;type&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;item&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;find&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;.grey&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;text&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;().&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;trim&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;

                &lt;span class=&quot;nx&quot;&gt;types&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;add&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;p&quot;&gt;});&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;});&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;nx&quot;&gt;console&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;types&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;

&lt;span class=&quot;nx&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;И на выходе:&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;Set {
  'Имя:',
  '',
  'Тип:',
  'До получения/продления скидки осталось:',
  'Телефон:',
  'Зарегистрирован(а):',
  'Email:',
  'Адрес:' }
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;То есть у нас есть 7 явных значений и одно “пустое”.
Краткий анализ содержания этой строки показал, что кроме &lt;code class=&quot;highlighter-rouge&quot;&gt;Заходил(а)&lt;/code&gt; там ничего нет.
Пустое значение объясняется тем, что в этом поле нет дочернего элемента &lt;code class=&quot;highlighter-rouge&quot;&gt;.grey&lt;/code&gt;. Но нам это никак не мешает.&lt;/p&gt;

&lt;h3 id=&quot;получение-чистых-данных&quot;&gt;Получение чистых данных&lt;/h3&gt;

&lt;p&gt;Во время анализа мы выяснили, что нужные нам данные лежат в параграфе (&lt;code class=&quot;highlighter-rouge&quot;&gt;p&lt;/code&gt;) без потомков.&lt;/p&gt;

&lt;p&gt;Так и гуглим: &lt;a href=&quot;https://www.google.com/search?q=jquery+get+text+without+child+elements&quot;&gt;jquery get text without child elements&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;И &lt;a href=&quot;https://stackoverflow.com/questions/3442394/using-text-to-retrieve-only-text-not-nested-in-child-tags&quot;&gt;получаем&lt;/a&gt; вот этот кусочек кода, который делает именно то, что нужно:&lt;/p&gt;

&lt;div class=&quot;language-javascript highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nx&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;item&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;clone&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;    &lt;span class=&quot;c1&quot;&gt;//clone the element&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;children&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;//select all the children&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;remove&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;   &lt;span class=&quot;c1&quot;&gt;//remove all the children&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;end&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;      &lt;span class=&quot;c1&quot;&gt;//again go back to selected element&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;text&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Помимо этого нужно убрать все лишние переносы и повторяющиеся пробелы, поэтому после &lt;code class=&quot;highlighter-rouge&quot;&gt;.text()&lt;/code&gt; добавляем еще 2 вызова:&lt;/p&gt;

&lt;div class=&quot;language-javascript highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;    &lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;trim&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;replace&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;sr&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;[\s]&lt;/span&gt;&lt;span class=&quot;sr&quot;&gt;+/g&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt; &lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;И в результате получаем красивую строку без лишнего мусора.&lt;/p&gt;

&lt;h3 id=&quot;обработка&quot;&gt;Обработка&lt;/h3&gt;

&lt;p&gt;У нас есть 8 типов данных, которые нам нужно по-отдельности проанализировать и привести к значению, которое можно сохранить в БД.&lt;/p&gt;

&lt;p&gt;Конечно нужно было это сделать раньше, но на этом этапе особенно важно знать, какие значения будут сохраняться в БД.&lt;/p&gt;

&lt;p&gt;После сбора информации выяснилось следующее:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Фамилия, Имя и Отчество хранятся в отдельных колонках.&lt;/li&gt;
  &lt;li&gt;Поле “Тип” обычно имеет 2 значения: “Обычный покупатель” и “Постоянный покупатель”, что в БД хранится как флаг (0 или 1 соответственно).&lt;/li&gt;
  &lt;li&gt;Поле “До получения/продления скидки осталось” сохраняется как число без указания валюты. То есть в рублях.&lt;/li&gt;
  &lt;li&gt;Телефон и Email сохраняются как есть.&lt;/li&gt;
  &lt;li&gt;Время регистрации и последнего посещения игнорируются.&lt;/li&gt;
  &lt;li&gt;Адрес в БД разбит на все составляющие, типа страны, города, индекса, улицы и п.р.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Для этого сделаем объект, в котором в качестве ключей будет тип данных, а значениями будут функции, которые обрабатывают пришедшие сырые данных:&lt;/p&gt;

&lt;div class=&quot;language-javascript highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kd&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;strategies&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;Имя:&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;content&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;},&lt;/span&gt;
    &lt;span class=&quot;dl&quot;&gt;''&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;content&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;},&lt;/span&gt;
    &lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;Тип:&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;content&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;},&lt;/span&gt;
    &lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;До получения/продления скидки осталось:&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;content&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;},&lt;/span&gt;
    &lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;Телефон:&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;content&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;},&lt;/span&gt;
    &lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;Зарегистрирован(а):&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;content&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;},&lt;/span&gt;
    &lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;Email:&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;content&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;},&lt;/span&gt;
    &lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;Адрес:&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;content&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;},&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Так как каждый тип данных может возвращать несколько значений для БД, то каждая функция должна возвращать объект, который будет объединен с остальными данными.
Если функция не вернет ничего, то ничего не будем делать.&lt;/p&gt;

&lt;div class=&quot;language-javascript highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kd&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;strategy&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;strategies&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;// Несмотря на то, что мы описали все стратегии обработки типов, &lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;// cлучаи &quot;а вдруг&quot; все равно стоит предусматривать&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;strategy&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;console&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;text&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;kd&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;result&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;strategy&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;text&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;||&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{};&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;// Про переменную person я пока ничего не говорил, &lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;// но в ней будут храниться все данные конкретного пользователя&lt;/span&gt;
&lt;span class=&quot;nx&quot;&gt;person&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;person&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;result&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;В итоге остается только описать стратегии обработки всех данных поочередно проверяя их формат.
Несмотря на то, что мы немного почистили данные, им все равно нельзя доверять.&lt;/p&gt;

&lt;p&gt;Вот что я выяснил на этом этапе:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;В графе с именем всего 3 части, разделенные пробелом. Всего частей может быть от 1 до 3.
В одном случае ФИО было разделено 2мя пробелами между частями. Поэтому очистка повторяющихся пробелов была очень кстати.&lt;/li&gt;
  &lt;li&gt;Поле “Тип” в большинстве своем имеет одно их 2-х значений: “Обычный покупатель” и “Постоянный покупатель”.
Но нашлись 3 записи формата “Представитель из Название_города”. Их решено пометить как “Постоянных покупателей”.&lt;/li&gt;
  &lt;li&gt;Поле “До получения/продления скидки осталось” &lt;strong&gt;всегда&lt;/strong&gt; имеет формат &lt;code class=&quot;highlighter-rouge&quot;&gt;[цифры][пробел]руб.&lt;/code&gt;, что упростило задачу.&lt;/li&gt;
  &lt;li&gt;В поле с адресом буквально располагался всякий мусор.
С этим уже ничего нельзя было сделать, поэтому решено все затолкать в одну колонку без какой-либо дополнительной обработки.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;В итоге у нас получается вот такая коллекция со стратегиями:&lt;/p&gt;

&lt;details class=&quot;spoiler&quot;&gt;&lt;summary class=&quot;spoiler-title&quot;&gt;Карта со стратегиями&lt;/summary&gt;&lt;div class=&quot;spoiler-body&quot;&gt;
&lt;div class=&quot;language-javascript highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kd&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;strategies&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;Имя:&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;content&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;kd&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;parts&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;content&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;split&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt; &lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

        &lt;span class=&quot;kd&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;name&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;dl&quot;&gt;''&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;surname&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;dl&quot;&gt;''&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;middlename&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;dl&quot;&gt;''&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;switch&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;parts&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;length&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
                &lt;span class=&quot;nx&quot;&gt;name&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;parts&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
                &lt;span class=&quot;k&quot;&gt;break&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
                &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;surname&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;parts&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
                &lt;span class=&quot;k&quot;&gt;break&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
                &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;middlename&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;surname&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;parts&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
                &lt;span class=&quot;k&quot;&gt;break&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

            &lt;span class=&quot;nl&quot;&gt;default&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
                &lt;span class=&quot;nx&quot;&gt;console&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;parts&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;middlename&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;surname&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;},&lt;/span&gt;
    &lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;Тип:&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;content&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;kd&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;regular_customer&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;content&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;===&lt;/span&gt; &lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;Обычный покупатель&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;nx&quot;&gt;regular_customer&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;regular_customer&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;},&lt;/span&gt;
    &lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;До получения/продления скидки осталось:&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;content&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;kd&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;parts&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;content&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;split&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt; &lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;parts&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;length&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!==&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;parts&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!==&lt;/span&gt; &lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;руб.&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;nx&quot;&gt;console&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;parts&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;na&quot;&gt;tmp_sum&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;parseInt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;parts&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]),&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;},&lt;/span&gt;
    &lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;Телефон:&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;phone&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;({&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;phone&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}),&lt;/span&gt;
    &lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;Email:&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;email&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;({&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;email&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}),&lt;/span&gt;
    &lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;Адрес:&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;address&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;({&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;address&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}),&lt;/span&gt;
    &lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;Зарегистрирован(а):&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;content&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;},&lt;/span&gt;
    &lt;span class=&quot;dl&quot;&gt;''&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;content&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;},&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;/div&gt;&lt;/details&gt;

&lt;p&gt;А сам код теперь выглядит так:&lt;/p&gt;

&lt;details class=&quot;spoiler&quot;&gt;&lt;summary class=&quot;spoiler-title&quot;&gt;Логика&lt;/summary&gt;&lt;div class=&quot;spoiler-body&quot;&gt;
&lt;div class=&quot;language-javascript highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kd&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;main&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;async&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;people&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[];&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kd&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;datum&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;of&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;kd&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;$&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;cheerio&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;load&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;datum&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

        &lt;span class=&quot;nx&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;.list-view .item&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;each&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;item&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;kd&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;person&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{};&lt;/span&gt;

            &lt;span class=&quot;nx&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;item&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;find&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;p&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;each&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;item&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;kd&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;type&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;item&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;find&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;.grey&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;text&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;().&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;trim&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;

                &lt;span class=&quot;kd&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;text&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;item&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                    &lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;clone&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
                    &lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;children&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
                    &lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;remove&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
                    &lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;end&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
                    &lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;text&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
                    &lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;trim&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
                    &lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;replace&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;sr&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;[\s]&lt;/span&gt;&lt;span class=&quot;sr&quot;&gt;+/g&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt; &lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

                &lt;span class=&quot;kd&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;strategy&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;strategies&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
                &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;strategy&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
                    &lt;span class=&quot;nx&quot;&gt;console&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;text&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

                    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
                &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

                &lt;span class=&quot;kd&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;result&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;strategy&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;text&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;||&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{};&lt;/span&gt;
                &lt;span class=&quot;nx&quot;&gt;person&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
                    &lt;span class=&quot;p&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;person&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
                    &lt;span class=&quot;p&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;result&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
                &lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;
            &lt;span class=&quot;p&quot;&gt;});&lt;/span&gt;

            &lt;span class=&quot;nx&quot;&gt;people&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;push&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;person&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;});&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;nx&quot;&gt;console&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;people&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;

&lt;span class=&quot;nx&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;/div&gt;&lt;/details&gt;

&lt;p&gt;Тут как раз можно увидеть появление массива &lt;code class=&quot;highlighter-rouge&quot;&gt;people&lt;/code&gt; наполненный объектами &lt;code class=&quot;highlighter-rouge&quot;&gt;person&lt;/code&gt;.&lt;/p&gt;

&lt;h3 id=&quot;приведение-к-единому-формату&quot;&gt;Приведение к единому формату&lt;/h3&gt;

&lt;p&gt;Теперь у нас есть почти все, чтобы идти дальше. Данные получены и обработаны.&lt;/p&gt;

&lt;p&gt;Но наша цель – положить все это в БД.&lt;/p&gt;

&lt;p&gt;Каждая стратегия описывалась таким образом, чтобы возвращенный объект был в виде, где ключ – колонка в таблице, а значение – ее содержание.&lt;/p&gt;

&lt;p&gt;На выходе мы получили массив с информацией о каждом пользователе. Но эта информация не однородна: у кого-то может не быть адреса, у кого-то – телефона или email-a.&lt;/p&gt;

&lt;p&gt;Поэтому нужно сделать некоторые атрибуты со значениями по умолчанию.
Берем все обязательные поля из таблицы и проставляем их в объект &lt;code class=&quot;highlighter-rouge&quot;&gt;person&lt;/code&gt; с указанными стандартными значениям:&lt;/p&gt;

&lt;div class=&quot;language-javascript highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kd&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;person&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;email&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;dl&quot;&gt;''&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;password&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;trash123&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;dl&quot;&gt;''&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;middlename&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;dl&quot;&gt;''&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;surname&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;dl&quot;&gt;''&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;phone&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;dl&quot;&gt;''&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;country&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;Россия&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;zip&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;dl&quot;&gt;''&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;region&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;dl&quot;&gt;''&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;city&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;dl&quot;&gt;''&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;address&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;dl&quot;&gt;''&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;tmp_sum&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;regular_customer&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;status&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Так как пароля мы узнать не можем, а в базе хранится только его хеш, поэтому вставляем туда любой мусор, который не является валидным хешем.&lt;/p&gt;

&lt;p&gt;Таким образом на выходе у нас будет массив объектов, каждый из которых имеет одинаковую структуру, порядок атрибутов и заполненные обязательные поля.&lt;/p&gt;

&lt;h3 id=&quot;формирование-файла-для-импорта-в-бд&quot;&gt;Формирование файла для импорта в БД&lt;/h3&gt;

&lt;p&gt;Тут решений тоже несколько.&lt;/p&gt;

&lt;p&gt;Ранее я пользовался &lt;a href=&quot;https://hiddentao.com/squel/&quot;&gt;Query Builder’ом&lt;/a&gt;, который на выходе давал мне сформированные SQL запросы в файлах,
которые достаточно было просто импортировать через PMA, либо запустить прямо на сервере.
Были сложности с экранированием, но в большинстве своем он меня устраивал.&lt;/p&gt;

&lt;p&gt;В этот раз я пошел другим путем. PMA вполне успешно умеет работать с различными форматами, включая CSV.&lt;/p&gt;

&lt;p&gt;Этот формат по сути подразумевает, что горизонтально твои данные будут разделены запятыми, а вертикально – переносами:&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&quot;1&quot;,&quot;Виталий&quot;,&quot;Заславский&quot;
&quot;2&quot;,&quot;Василий&quot;,&quot;Пупкин&quot;
&quot;3&quot;,&quot;Петр&quot;,&quot;Васечкин&quot;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Все достаточно просто и соответствовало тому, что мы делаем.&lt;/p&gt;

&lt;p&gt;Создание контента для CVS укладывается в 4 строчки:&lt;/p&gt;

&lt;div class=&quot;language-javascript highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kd&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;result&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;people&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;map&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;person&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;Object&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;values&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;person&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// Получаем только значения из всех объектов&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;map&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;_&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;_&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;replace&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;?&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;_&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;replace&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;sr&quot;&gt;/&quot;/g&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&quot;&quot;&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;_&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// Экранируем двойные кавычки &quot; =&amp;gt; &quot;&quot; (таков CSV, не я это придумал)&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;map&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;_&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;`&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;_&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;`&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// Обрамление содержимого двойными кавычками&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;join&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// Объединение значений&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;join&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// Объединение всех полученных значений переносами&lt;/span&gt;

&lt;span class=&quot;nx&quot;&gt;console&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;result&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Результатом проделанных действий будет выплюнутое в консоль содержание CSV файла. 
С сохранением этого через &lt;code class=&quot;highlighter-rouge&quot;&gt;fs&lt;/code&gt; модуль я не стал. Вот эта команда сделала все за меня:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;node index.js &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; result.csv
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;соберем-все-воедино&quot;&gt;Соберем все воедино&lt;/h3&gt;

&lt;p&gt;Вот так будет выглядеть скрипт, если собрать все его части:&lt;/p&gt;

&lt;details class=&quot;spoiler&quot;&gt;&lt;summary class=&quot;spoiler-title&quot;&gt;Большой кусок кода&lt;/summary&gt;&lt;div class=&quot;spoiler-body&quot;&gt;
&lt;div class=&quot;language-javascript highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kd&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;cheerio&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;require&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;cheerio&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;kd&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;data&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;require&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;./data.json&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

&lt;span class=&quot;kd&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;strategies&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;Имя:&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;content&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;kd&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;parts&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;content&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;split&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt; &lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

        &lt;span class=&quot;kd&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;name&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;dl&quot;&gt;''&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;surname&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;dl&quot;&gt;''&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;middlename&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;dl&quot;&gt;''&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;switch&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;parts&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;length&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
                &lt;span class=&quot;nx&quot;&gt;name&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;parts&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
                &lt;span class=&quot;k&quot;&gt;break&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
                &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;surname&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;parts&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
                &lt;span class=&quot;k&quot;&gt;break&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
                &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;middlename&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;surname&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;parts&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
                &lt;span class=&quot;k&quot;&gt;break&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

            &lt;span class=&quot;nl&quot;&gt;default&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
                &lt;span class=&quot;nx&quot;&gt;console&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;parts&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;middlename&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;surname&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;},&lt;/span&gt;
    &lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;Тип:&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;content&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;kd&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;regular_customer&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;content&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;===&lt;/span&gt; &lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;Обычный покупатель&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;nx&quot;&gt;regular_customer&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;regular_customer&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;},&lt;/span&gt;
    &lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;До получения/продления скидки осталось:&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;content&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;kd&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;parts&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;content&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;split&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt; &lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;parts&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;length&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!==&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;parts&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!==&lt;/span&gt; &lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;руб.&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;nx&quot;&gt;console&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;parts&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;na&quot;&gt;tmp_sum&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;parseInt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;parts&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]),&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;},&lt;/span&gt;
    &lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;Телефон:&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;phone&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;({&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;phone&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}),&lt;/span&gt;
    &lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;Email:&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;email&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;({&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;email&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}),&lt;/span&gt;
    &lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;Адрес:&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;address&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;({&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;address&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}),&lt;/span&gt;
    &lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;Зарегистрирован(а):&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;content&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;},&lt;/span&gt;
    &lt;span class=&quot;dl&quot;&gt;''&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;content&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;},&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;

&lt;span class=&quot;kd&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;main&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;async&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;people&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[];&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kd&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;datum&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;of&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;kd&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;$&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;cheerio&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;load&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;datum&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

        &lt;span class=&quot;nx&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;.list-view .item&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;each&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;item&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;kd&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;person&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;na&quot;&gt;email&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;dl&quot;&gt;''&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
                &lt;span class=&quot;na&quot;&gt;password&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;trash123&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
                &lt;span class=&quot;na&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;dl&quot;&gt;''&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
                &lt;span class=&quot;na&quot;&gt;middlename&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;dl&quot;&gt;''&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
                &lt;span class=&quot;na&quot;&gt;surname&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;dl&quot;&gt;''&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
                &lt;span class=&quot;na&quot;&gt;phone&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;dl&quot;&gt;''&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
                &lt;span class=&quot;na&quot;&gt;country&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;Россия&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
                &lt;span class=&quot;na&quot;&gt;zip&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;dl&quot;&gt;''&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
                &lt;span class=&quot;na&quot;&gt;region&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;dl&quot;&gt;''&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
                &lt;span class=&quot;na&quot;&gt;city&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;dl&quot;&gt;''&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
                &lt;span class=&quot;na&quot;&gt;address&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;dl&quot;&gt;''&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
                &lt;span class=&quot;na&quot;&gt;tmp_sum&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
                &lt;span class=&quot;na&quot;&gt;regular_customer&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
                &lt;span class=&quot;na&quot;&gt;status&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
            &lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;

            &lt;span class=&quot;nx&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;item&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;find&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;p&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;each&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;item&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;kd&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;type&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;item&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;find&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;.grey&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;text&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;().&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;trim&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;

                &lt;span class=&quot;kd&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;text&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;item&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                    &lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;clone&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
                    &lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;children&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
                    &lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;remove&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
                    &lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;end&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
                    &lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;text&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
                    &lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;trim&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
                    &lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;replace&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;sr&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;[\s]&lt;/span&gt;&lt;span class=&quot;sr&quot;&gt;+/g&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt; &lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

                &lt;span class=&quot;kd&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;strategy&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;strategies&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
                &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;strategy&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
                    &lt;span class=&quot;nx&quot;&gt;console&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;text&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

                    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
                &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

                &lt;span class=&quot;kd&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;result&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;strategy&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;text&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;||&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{};&lt;/span&gt;
                &lt;span class=&quot;nx&quot;&gt;person&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
                    &lt;span class=&quot;p&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;person&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
                    &lt;span class=&quot;p&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;result&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
                &lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;
            &lt;span class=&quot;p&quot;&gt;});&lt;/span&gt;

            &lt;span class=&quot;nx&quot;&gt;people&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;push&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;person&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;});&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;


    &lt;span class=&quot;kd&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;result&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;people&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;map&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;person&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;Object&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;values&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;person&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;map&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;_&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;_&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;replace&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;?&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;_&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;replace&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;sr&quot;&gt;/&quot;/g&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&quot;&quot;&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;_&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;map&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;_&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;`&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;_&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;`&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;join&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;join&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

    &lt;span class=&quot;nx&quot;&gt;console&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;result&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;

&lt;span class=&quot;nx&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;/div&gt;&lt;/details&gt;

&lt;p&gt;Не думаю, что эта простыня нуждается в каком-либо дополнительном пояснении.&lt;/p&gt;

&lt;h2 id=&quot;шаг-четвертый-наполнение-таблицы&quot;&gt;Шаг четвертый. Наполнение таблицы&lt;/h2&gt;

&lt;p&gt;Это самый простой шаг. Все действия будут происходить через PMA панель.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Нужно перейти в нужную таблицу.&lt;/li&gt;
  &lt;li&gt;Ткнуть в “Импорт”.&lt;/li&gt;
  &lt;li&gt;Выбрать нужный файл.&lt;/li&gt;
  &lt;li&gt;Формат указать “CSV” (“CSV using LOAD DATA” не пробовал).&lt;/li&gt;
  &lt;li&gt;В “Названия столбцов” указать нужные столбцы через запятую.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;По поводу последнего шага.
Несмотря на то, что мы почти скопировали поля из таблицы в указанном порядке, есть случаи, когда данные указываются автоматически самой БД.
В моем случае это было поле &lt;code class=&quot;highlighter-rouge&quot;&gt;id&lt;/code&gt;. Поэтому при импорте достаточно указать в этом поле все атрибуты из объекта &lt;code class=&quot;highlighter-rouge&quot;&gt;person&lt;/code&gt; через запятую:&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;email,password,name,middlename,surname,phone,country,zip,region,city,address,tmp_sum,regular_customer,status
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Жмем “Вперёд” и Вуоля! Работа завершена!&lt;/p&gt;

&lt;h2 id=&quot;что-можно-было-сделать-еще&quot;&gt;Что можно было сделать еще&lt;/h2&gt;

&lt;p&gt;Моей задачей было сделать то, что хотел заказчик. Его уcтраивало то, что в поле с адресом лежит мусор, а на месте фамилии может стоять отчество.&lt;/p&gt;

&lt;p&gt;И подручными средствами решить эту проблему было не столько сложно, сколько невозможно в короткий срок.&lt;/p&gt;

&lt;p&gt;Но если с этой проблемой столкнулся я, значит были и другие. А значит есть инструменты, которые решают подобного рода задачи.&lt;/p&gt;

&lt;p&gt;Адрес можно было привести к единому виду с помощью &lt;a href=&quot;https://tech.yandex.ru/maps/doc/geocoder/desc/concepts/input_params-docpage/&quot;&gt;API Яндекс.Карт&lt;/a&gt;. Единственное, что он не умеет – определять номер квартиры из адреса.&lt;/p&gt;

&lt;p&gt;Либо можно было воспользоваться сервисом &lt;a href=&quot;https://dadata.ru/api/clean/&quot;&gt;Dadata&lt;/a&gt;, который и квартиру в адресе определит, и ФИО из любого формата к красивому приведет.&lt;/p&gt;

&lt;p&gt;То есть решения были, только заказчику этого было не нужно :grin:&lt;/p&gt;

&lt;h2 id=&quot;в-качестве-заключения&quot;&gt;В качестве заключения&lt;/h2&gt;

&lt;p&gt;Статья получилась невероятно большой для сравнительно небольшого объема информации. Но содержательной.&lt;/p&gt;

&lt;p&gt;То, что я сейчас описал, называется &lt;em&gt;“Веб-скрапинг”&lt;/em&gt;.
В моем случае это просто перенос данных с одного сайта на другой путем вывода информации прямо со страниц.&lt;/p&gt;

&lt;p&gt;В других случаях веб-скрапинг используется для сбора информации из нескольких сайтов для агрегирования информации в одном месте.
Например, &lt;a href=&quot;https://habr.com/ru/post/353348/&quot;&gt;афиши кинотеатров&lt;/a&gt;. Еще этот подход используется для того, чтобы сделать API там, где его официально нет, и т.д.&lt;/p&gt;

&lt;p&gt;Да, я знаю и слышал, что есть инструменты более мощные и серьезные. Но в моем случае гораздо быстрее воспользоваться тем, что я уже хорошо знаю.&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;А мораль сей статьи такова: автоматизируйте все, что автоматизируется.
Используйте все подручные средства, чтобы компьютер сделал за вас бо́льшую часть работы.
Не делайте руками то, что можно сделать скриптом на 150 строк.
В определенный момент вы поймете – это окупается :wink:&lt;/p&gt;</content><author><name>Виталий Заславский</name><email>vtvz@pm.me</email></author><category term="Веб-разработка" /><category term="Базы данных" /><summary type="html">Один мой хороший знакомый и коллега обратился ко мне за помощью. Он делал для одной компании новый сайт взамен старому. Данные со старого, естественно, должны были переместиться на новый. В этом и заключалась моя задача. Было только одно простое условие – доступа к БД старого сайта ни у меня, ни у него не было. В этой статье я хочу на практике показать, что можно сделать в этой ситуации, несмотря на отсутствие адекватной разметки в коде страницы.</summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="https://vtvz.ru/assets/images/logo-black.png" /><media:content medium="image" url="https://vtvz.ru/assets/images/logo-black.png" xmlns:media="http://search.yahoo.com/mrss/" /></entry><entry><title type="html">Свершилось! Часть первая. Зачем мне блог</title><link href="https://vtvz.ru/blog/openning/" rel="alternate" type="text/html" title="Свершилось! Часть первая. Зачем мне блог" /><published>2018-12-19T00:00:00+03:00</published><updated>2018-12-19T00:00:00+03:00</updated><id>https://vtvz.ru/blog/openning</id><content type="html" xml:base="https://vtvz.ru/blog/openning/">&lt;p&gt;Я долго к этому шел. Серьезно, на это ушел не один год (4 года приблизительно, точно не знаю).
Мысль была давно. Непосредственно разработка заняла у меня немного. Но созревал я на самом деле долго.&lt;/p&gt;

&lt;p&gt;В дебютной статье я бы хотел рассказать о мотивах и причинах, которые привели меня к этому. 
А также постараюсь ответить на вопросы, которые мне еще никто не задавал, но, возможно, задаст :blush:&lt;/p&gt;

&lt;!--cut--&gt;

&lt;h3 id=&quot;немного-истории&quot;&gt;Немного истории&lt;/h3&gt;

&lt;p&gt;Где-то в “далеком” 2013м был приобретен домен &lt;code class=&quot;highlighter-rouge&quot;&gt;vtvz.ru&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;&lt;em&gt;- Что означают эти буквы?&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;Это почти аббревиатура моего ФИО. Домен из трех букв застолбить не удалось – все 3 варианта (&lt;code class=&quot;highlighter-rouge&quot;&gt;zvv&lt;/code&gt;, &lt;code class=&quot;highlighter-rouge&quot;&gt;vzv&lt;/code&gt;, &lt;code class=&quot;highlighter-rouge&quot;&gt;vvz&lt;/code&gt;) были уже заняты. 
Из всех доступных четырехбуквенных вариантов этот приглянулся мне больше всего.&lt;/p&gt;

&lt;p&gt;Долгое время это было просто домен, который делал целое ничего.&lt;/p&gt;

&lt;p&gt;Первое, что на нем появилось, был обычный сайт визитка. Выглядел он так:&lt;/p&gt;

&lt;figure&gt;
  &lt;img src=&quot;screen.png&quot; alt=&quot;Скриншот&quot; /&gt;
&lt;/figure&gt;

&lt;p&gt;Знакомо? Это было временное решение. Но ничто так не постоянно, как временное.&lt;/p&gt;

&lt;p&gt;Долгое время сайт был чисто визиткой. До блога он дорос только сейчас.&lt;/p&gt;

&lt;h3 id=&quot;зачем-тебе-блог&quot;&gt;“Зачем тебе блог?”&lt;/h3&gt;

&lt;p&gt;На этот вопрос есть 2 ответа: потому что &lt;strong&gt;могу&lt;/strong&gt; и потому что &lt;strong&gt;хочу&lt;/strong&gt;.&lt;/p&gt;

&lt;p&gt;Целями этого блога не являются получение прибыли или обретение популярности. Оно работает немного не так.&lt;/p&gt;

&lt;p&gt;Есть вещи, которыми хочется делиться:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Я победил какую-то ошибку;&lt;/li&gt;
  &lt;li&gt;Познакомился с новой технологией или программой;&lt;/li&gt;
  &lt;li&gt;Съездил в новую для себя страну или город;&lt;/li&gt;
  &lt;li&gt;Нашел новый для себя подход к решению какой-то проблемы;&lt;/li&gt;
  &lt;li&gt;Меня что-то очень сильно раздражает;&lt;/li&gt;
  &lt;li&gt;И так далее…&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Блог – это идеальное место, чтобы выплеснуть все, что не дает спать по ночам.&lt;/p&gt;

&lt;h3 id=&quot;почему-ты-не-использовал-название_сервиса-для-этого&quot;&gt;“Почему ты не использовал &lt;code class=&quot;highlighter-rouge&quot;&gt;%название_сервиса%&lt;/code&gt; для этого?”&lt;/h3&gt;

&lt;p&gt;Я прекрасно понимаю, что многое до меня уже было сделано:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Олдскульный &lt;a href=&quot;https://www.livejournal.com/&quot;&gt;LiveJournal&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;Новомодный &lt;a href=&quot;https://medium.com/&quot;&gt;Medium&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;Малоизвестный &lt;a href=&quot;https://www.blogger.com/&quot;&gt;Blogger&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;И куча социальных сетей, которые поддерживают лонгриды&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Выбор велик. Я мог взять любой и получил бы тачку плюсов впридачу:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Такие сервисы хорошо индексируются поисковиками без дополнительных усилий, поэтому в поисковые выдачи хороший пост может попасть достаточно быстро;&lt;/li&gt;
  &lt;li&gt;Если ты хороший автор, сам сервис может тебя рекомендовать к прочтению пользователям;&lt;/li&gt;
  &lt;li&gt;Минимальные затраты на создание поста и блога – зарегистрировался и пиши;&lt;/li&gt;
  &lt;li&gt;Люди будут охотнее переходить на уже знакомые им сайты, чем на что-то им неизвестное;&lt;/li&gt;
  &lt;li&gt;Пользователям более привычен интерфейс используемого ими сервиса, а не какого-то чужого сайта;&lt;/li&gt;
  &lt;li&gt;Популярные сервисы выдерживают большие нагрузки и скорее всего будут жить дольше, чем сайт на своем сервере.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Сам не ожидал, что найду столько по-настоящему весомых плюсов. Но есть и минусы:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Используя какой-то сервис, ты даришь ему свой контент и он распоряжается им как хочет:
может забанить,
может удалить,
может зарабатывать на нем деньги, что они, собственно, и делают.&lt;/li&gt;
  &lt;li&gt;Ты упираешься в серьезные ограничения, которые накладывает на тебя этот сервис в техническом плане:
    &lt;ul&gt;
      &lt;li&gt;Что-то кастомизировать бывает очень сложно или даже невозможно;&lt;/li&gt;
      &lt;li&gt;Если и возможно, то с болью и мучениями;&lt;/li&gt;
      &lt;li&gt;А некоторые функции вообще могут быть платными, типа привязки к своему домену.&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Когда создаешь свой блог, ты получаешь одно большое преимущество: он &lt;strong&gt;абсолютно и полностью твой&lt;/strong&gt;.
Ты распоряжаешься им как хочешь, и делаешь с ним, что пожелаешь.
Единственные твои ограничения – браузер, выбранные технологии и твоя фантазия.&lt;/p&gt;

&lt;p&gt;Да, продвигать свой сайт намного сложнее. Для этого нужны специальные знания и подготовка.
Но если цель блога творческая, а не коммерческая, то это не является сильной проблемой.&lt;/p&gt;

&lt;p&gt;Я написал статью на &lt;a href=&quot;https://www.facebook.com/notes/%D0%B2%D0%B8%D1%82%D0%B0%D0%BB%D0%B8%D0%B9-%D0%B7%D0%B0%D1%81%D0%BB%D0%B0%D0%B2%D1%81%D0%BA%D0%B8%D0%B9/%D0%BC%D0%B5%D0%BD%D0%B5%D0%B4%D0%B6%D0%B5%D1%80-%D0%BF%D0%B0%D1%80%D0%BE%D0%BB%D0%B5%D0%B9-%D1%81-%D1%81%D0%B0%D1%85%D0%B0%D1%80%D0%BE%D0%BC/1107932535931749/&quot;&gt;Facebook&lt;/a&gt; про некоторые возможности менеджера паролей.
Несколько мыслей и заметок там-же на &lt;a href=&quot;https://www.facebook.com/vtvz.ru&quot;&gt;моей странице&lt;/a&gt;.
Есть две статьи на Хабре (&lt;a href=&quot;https://habrahabr.ru/post/343572/&quot;&gt;первая&lt;/a&gt;, &lt;a href=&quot;https://habr.com/post/354742/&quot;&gt;вторая&lt;/a&gt;),
которые суммарно посмотрело около 47т. человек.&lt;/p&gt;

&lt;p&gt;Но они оба обладают всеми описанными недостатками.
Facebook – социальная сеть, а Хабр – &lt;strong&gt;не&lt;/strong&gt; то место, где можно просто выговориться.
Туда можно писать только то, что будет интересно IT сообществу, а не личные заметки типа “как я провел лето”.&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;В итоге я и пришел к тому, что хочу сделать свой личный сайт-визитку-блог.
Потому что хочу. Потому что могу.
В нем еще нет некоторой функциональности, типа комментариев,
куча мертвого кода и неиспользуемых стилей,
проблемы с дизайном и отступами, нужно разобраться со шрифтами и п.р.
И пусть его особо никто читать не будет. Я буду рад даже двум посетителям (жене и маме :wink:).&lt;/p&gt;

&lt;p&gt;Статистику я, конечно же, сюда подключу. Все равно интересно :stuck_out_tongue_closed_eyes:&lt;/p&gt;

&lt;p&gt;На этом статья считается завершенной, а блог объявляется открытым! :tada:&lt;/p&gt;

&lt;p&gt;В следующей (а может быть и в нескольких статьях) я расскажу о технической составляющей моего сайта:
дизайн, используемые технологии, хостинг и прочее.&lt;/p&gt;</content><author><name>Виталий Заславский</name><email>vtvz@pm.me</email></author><category term="Блог" /><category term="Веб-разработка" /><summary type="html">Я долго к этому шел. Серьезно, на это ушел не один год (4 года приблизительно, точно не знаю). Мысль была давно. Непосредственно разработка заняла у меня немного. Но созревал я на самом деле долго. В дебютной статье я бы хотел рассказать о мотивах и причинах, которые привели меня к этому. А также постараюсь ответить на вопросы, которые мне еще никто не задавал, но, возможно, задаст :blush:</summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="https://vtvz.ru/assets/images/logo-black.png" /><media:content medium="image" url="https://vtvz.ru/assets/images/logo-black.png" xmlns:media="http://search.yahoo.com/mrss/" /></entry></feed>